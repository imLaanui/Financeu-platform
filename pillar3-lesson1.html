<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 1 - Understanding Credit Scores - FinanceU</title>
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <link rel="icon" type="image/svg+xml" sizes="16x16" href="assets/favicon-16x16.svg">
    <link rel="icon" type="image/svg+xml" sizes="32x32" href="assets/favicon-32x32.svg">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/apple-touch-icon.svg">
    <link rel="stylesheet" href="styles.css">
    <style>
        .lesson-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        .lesson-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 50px 30px;
            background: linear-gradient(135deg, #0A1A2F 0%, #00A676 100%);
            border-radius: 20px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 166, 118, 0.3);
        }
        .lesson-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.15) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .lesson-header h1 {
            font-size: 56px;
            font-weight: 900;
            color: white;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .lesson-header .lesson-number {
            color: #00A676;
            font-size: 20px;
            font-weight: 800;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
            text-transform: uppercase;
            letter-spacing: 3px;
            background: white;
            padding: 8px 24px;
            border-radius: 50px;
            display: inline-block;
        }
        .lesson-section {
            background: white;
            padding: 40px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 3px solid transparent;
            transition: all 0.3s ease;
        }
        .lesson-section:hover {
            border-color: #00A676;
            box-shadow: 0 8px 24px rgba(0, 166, 118, 0.2);
            transform: translateY(-4px);
        }
        .lesson-section h2 {
            color: #0A1A2F;
            font-size: 48px;
            font-weight: 800;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .section-icon {
            font-size: 64px;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.1));
        }
        .lesson-section p {
            line-height: 1.8;
            color: var(--text-secondary);
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 500;
        }
        .lesson-section strong {
            color: #0A1A2F;
            font-weight: 700;
        }

        /* Color-coded callout boxes */
        .key-concept-box {
            background: #EFF6FF;
            border: 4px solid #3B82F6;
            border-radius: 16px;
            padding: 30px;
            margin: 30px 0;
            position: relative;
        }
        .key-concept-box h3 {
            color: #1E40AF;
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 15px;
        }
        .key-concept-box p {
            color: #1E3A8A;
            font-size: 18px;
            line-height: 1.7;
        }

        .warning-box {
            background: #FEE2E2;
            border: 4px solid #DC2626;
            border-radius: 16px;
            padding: 30px;
            margin: 30px 0;
        }
        .warning-box h3 {
            color: #991B1B;
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 15px;
        }
        .warning-box p {
            color: #7F1D1D;
            font-size: 18px;
            line-height: 1.7;
        }

        .action-box {
            background: #FEF3C7;
            border: 4px solid #F59E0B;
            border-radius: 16px;
            padding: 30px;
            margin: 30px 0;
        }
        .action-box h3 {
            color: #B45309;
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 15px;
        }
        .action-box ul {
            list-style: none;
            padding: 0;
        }
        .action-box li {
            color: #78350F;
            font-size: 18px;
            font-weight: 600;
            padding: 12px 0;
            border-bottom: 2px solid #FCD34D;
        }
        .action-box li:last-child {
            border-bottom: none;
        }
        .action-box li::before {
            content: '‚úì';
            color: #F59E0B;
            font-weight: 900;
            font-size: 24px;
            margin-right: 12px;
        }

        .real-world-box {
            background: #F3E8FF;
            border: 4px solid #9333EA;
            border-radius: 16px;
            padding: 30px;
            margin: 30px 0;
        }
        .real-world-box h3 {
            color: #6B21A8;
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 15px;
        }
        .real-world-box p {
            color: #581C87;
            font-size: 18px;
            line-height: 1.7;
            font-weight: 600;
        }

        /* Score ranges */
        .score-ranges {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .score-card {
            background: white;
            border: 4px solid #E5E7EB;
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s;
        }
        .score-card:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
        }
        .score-card.poor {
            border-color: #DC2626;
            background: linear-gradient(135deg, #FEE2E2 0%, #FECACA 100%);
        }
        .score-card.fair {
            border-color: #F59E0B;
            background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
        }
        .score-card.good {
            border-color: #10B981;
            background: linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%);
        }
        .score-card.very-good {
            border-color: #3B82F6;
            background: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%);
        }
        .score-card.excellent {
            border-color: #9333EA;
            background: linear-gradient(135deg, #F3E8FF 0%, #E9D5FF 100%);
        }
        .score-range {
            font-size: 32px;
            font-weight: 900;
            margin-bottom: 10px;
        }
        .score-label {
            font-size: 20px;
            font-weight: 800;
            text-transform: uppercase;
        }

        /* Credit factors */
        .factors-grid {
            display: grid;
            gap: 20px;
            margin: 30px 0;
        }
        .factor-card {
            background: white;
            border: 3px solid #E5E7EB;
            border-radius: 16px;
            padding: 25px;
            display: flex;
            align-items: center;
            gap: 20px;
            transition: all 0.3s;
        }
        .factor-card:hover {
            border-color: #00A676;
            box-shadow: 0 8px 24px rgba(0, 166, 118, 0.2);
            transform: translateX(8px);
        }
        .factor-percentage {
            font-size: 64px;
            font-weight: 900;
            color: #00A676;
            min-width: 120px;
            text-align: center;
        }
        .factor-details h3 {
            font-size: 24px;
            font-weight: 800;
            color: #0A1A2F;
            margin-bottom: 8px;
        }
        .factor-details p {
            font-size: 16px;
            color: var(--text-secondary);
            margin: 0;
        }

        /* Quiz styles */
        .quiz-container {
            background: linear-gradient(135deg, #0A1A2F 0%, #00A676 100%);
            border: 5px solid #00A676;
            border-radius: 20px;
            padding: 40px;
            margin: 40px 0;
            box-shadow: 0 12px 40px rgba(0, 166, 118, 0.3);
        }
        .quiz-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .quiz-header h2 {
            color: white;
            font-size: 48px;
            font-weight: 900;
            margin-bottom: 15px;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .quiz-header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 18px;
            font-weight: 600;
        }
        .question-card {
            background: white;
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 3px solid transparent;
        }
        .question-text {
            font-size: 22px;
            font-weight: 700;
            color: #0A1A2F;
            margin-bottom: 20px;
        }
        .answer-option {
            background: #F9FAFB;
            padding: 18px;
            border: 3px solid #E5E7EB;
            border-radius: 12px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 18px;
            font-weight: 600;
        }
        .answer-option:hover {
            border-color: #00A676;
            background: #D1FAE5;
            transform: translateX(8px);
        }
        .answer-option.selected {
            border-color: #00A676;
            background: #D1FAE5;
        }
        .answer-option.correct {
            border-color: #10B981;
            background: #6EE7B7;
            color: #064E3B;
        }
        .answer-option.incorrect {
            border-color: #DC2626;
            background: #FCA5A5;
            color: #7F1D1D;
        }

        .btn-submit-quiz {
            display: block;
            width: 100%;
            max-width: 400px;
            margin: 25px auto;
            padding: 20px;
            background: white;
            color: #0A1A2F;
            text-align: center;
            border-radius: 12px;
            font-size: 20px;
            font-weight: 800;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .btn-submit-quiz:hover {
            background: #00A676;
            color: white;
            transform: scale(1.05);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        }

        .quiz-result {
            background: white;
            padding: 40px;
            border-radius: 16px;
            text-align: center;
            margin-top: 25px;
            border: 4px solid #E5E7EB;
        }
        .quiz-result.pass {
            border-color: #10B981;
        }
        .quiz-result.fail {
            border-color: #DC2626;
        }
        .result-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }
        .result-text {
            font-size: 36px;
            font-weight: 900;
            margin-bottom: 15px;
        }
        .result-score {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 25px;
        }

        /* Finish button */
        .btn-finish {
            display: block;
            width: 100%;
            height: 56px;
            margin: 40px auto;
            padding: 0 40px;
            background: linear-gradient(135deg, #0A1A2F 0%, #00A676 100%);
            color: white;
            text-align: center;
            text-decoration: none;
            border-radius: 12px;
            font-size: 24px;
            font-weight: 800;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            line-height: 56px;
            box-shadow: 0 8px 24px rgba(0, 166, 118, 0.3);
        }
        .btn-finish:hover {
            transform: scale(1.02);
            box-shadow: 0 12px 32px rgba(0, 166, 118, 0.4);
        }
        .btn-finish:disabled {
            background: #9CA3AF;
            cursor: not-allowed;
            opacity: 0.6;
            transform: none;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #00A676;
            text-decoration: none;
            font-weight: 700;
            font-size: 18px;
            transition: all 0.2s;
        }
        .back-link:hover {
            transform: translateX(-8px);
            color: #0A1A2F;
        }

        /* Multi-screen navigation */
        .lesson-section {
            display: none;
        }
        .lesson-section.active {
            display: block;
            animation: fadeIn 0.4s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .lesson-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 30px 0;
            gap: 20px;
        }
        .nav-button {
            padding: 14px 28px;
            background: linear-gradient(135deg, #0A1A2F 0%, #00A676 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .nav-button:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 166, 118, 0.4);
        }
        .nav-button:disabled {
            background: #9CA3AF;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .progress-indicator {
            flex: 1;
            text-align: center;
        }
        .progress-bar {
            height: 8px;
            background: #E5E7EB;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00A676 0%, #10B981 100%);
            transition: width 0.4s ease;
        }
        .progress-text {
            font-size: 14px;
            font-weight: 700;
            color: #0A1A2F;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-wrapper">
                <div class="logo"><a href="/" style="color: inherit; text-decoration: none;">Finance<span class="logo-accent">U</span></a></div>
                <ul class="nav-links">
                    <li><a href="/">Home</a></li>
                    <li><a href="dashboard">Dashboard</a></li>
                    <li id="authButtons" style="opacity: 0;"></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Lesson Content -->
    <div class="lesson-container">
        <a href="/pillar3-lessons" class="back-link">‚Üê Back to Pillar 3 Lessons</a>

        <!-- Header -->
        <div class="lesson-header">
            <div class="lesson-number">PILLAR 3: LESSON 1</div>
            <h1>Understanding Credit Scores</h1>
        </div>

        <!-- What Are Credit Scores -->
        <div class="lesson-section">
            <h2><span class="section-icon">üìä</span>What is a Credit Score?</h2>
            <p>A <strong>credit score</strong> is a three-digit number ranging from <strong>300 to 850</strong> that represents your creditworthiness. Think of it as your financial report card that lenders use to decide if they'll give you loans and at what interest rate.</p>

            <div class="key-concept-box">
                <h3>üí° Key Concept</h3>
                <p>Your credit score is calculated by credit bureaus (Experian, Equifax, TransUnion) based on your credit history. Higher scores mean you're seen as less risky to lend to, which means better loan terms and lower interest rates.</p>
            </div>
        </div>

        <!-- Why It Matters -->
        <div class="lesson-section">
            <h2><span class="section-icon">üéØ</span>Why Your Credit Score Matters</h2>
            <p>Your credit score affects major life decisions:</p>
            <ul style="font-size: 18px; line-height: 2; color: var(--text-secondary); margin-left: 30px;">
                <li><strong>Mortgage rates:</strong> Can save or cost you hundreds of thousands of dollars</li>
                <li><strong>Loan approval:</strong> Determines if you can get car loans, personal loans, credit cards</li>
                <li><strong>Apartment rentals:</strong> Landlords check credit scores before approving tenants</li>
                <li><strong>Insurance rates:</strong> Some insurers use credit scores to set premiums</li>
                <li><strong>Job opportunities:</strong> Some employers check credit for certain positions</li>
            </ul>
        </div>

        <!-- The 5 Factors -->
        <div class="lesson-section">
            <h2><span class="section-icon">‚öñÔ∏è</span>The 5 Factors That Determine Your Score</h2>

            <div class="factors-grid">
                <div class="factor-card">
                    <div class="factor-percentage">35%</div>
                    <div class="factor-details">
                        <h3>Payment History</h3>
                        <p>Do you pay bills on time? This is the most important factor. Even one late payment can hurt your score.</p>
                    </div>
                </div>

                <div class="factor-card">
                    <div class="factor-percentage">30%</div>
                    <div class="factor-details">
                        <h3>Credit Utilization</h3>
                        <p>How much of your available credit are you using? Keep it under 30% for best results. Lower is better.</p>
                    </div>
                </div>

                <div class="factor-card">
                    <div class="factor-percentage">15%</div>
                    <div class="factor-details">
                        <h3>Length of Credit History</h3>
                        <p>How long have you had credit accounts? Older accounts help your score. Don't close old cards!</p>
                    </div>
                </div>

                <div class="factor-card">
                    <div class="factor-percentage">10%</div>
                    <div class="factor-details">
                        <h3>Credit Mix</h3>
                        <p>Do you have different types of credit? Credit cards, car loans, student loans, etc. Variety helps.</p>
                    </div>
                </div>

                <div class="factor-card">
                    <div class="factor-percentage">10%</div>
                    <div class="factor-details">
                        <h3>New Credit Inquiries</h3>
                        <p>How many times have you applied for credit recently? Too many applications in a short time hurts your score.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Score Ranges -->
        <div class="lesson-section">
            <h2><span class="section-icon">üéöÔ∏è</span>Credit Score Ranges Explained</h2>

            <div class="score-ranges">
                <div class="score-card poor">
                    <div class="score-range">300-579</div>
                    <div class="score-label">Poor</div>
                </div>
                <div class="score-card fair">
                    <div class="score-range">580-669</div>
                    <div class="score-label">Fair</div>
                </div>
                <div class="score-card good">
                    <div class="score-range">670-739</div>
                    <div class="score-label">Good</div>
                </div>
                <div class="score-card very-good">
                    <div class="score-range">740-799</div>
                    <div class="score-label">Very Good</div>
                </div>
                <div class="score-card excellent">
                    <div class="score-range">800-850</div>
                    <div class="score-label">Excellent</div>
                </div>
            </div>

            <div class="warning-box">
                <h3>‚ö†Ô∏è Important Warning</h3>
                <p>A score below 670 will make it difficult to get approved for loans, and if you do get approved, you'll pay much higher interest rates. Focus on getting your score to at least 700.</p>
            </div>
        </div>

        <!-- Real World Example -->
        <div class="lesson-section">
            <h2><span class="section-icon">üåç</span>Real-World Impact</h2>

            <div class="real-world-box">
                <h3>üí∞ The Cost of a Bad Credit Score</h3>
                <p><strong>Sarah's 740 score got her a 3.5% mortgage rate. Jake's 620 score got 6.2%.</strong></p>
                <p style="margin-top: 15px;">On a $300,000 house over 30 years, that's <strong>$186,000 MORE in interest</strong> that Jake will pay. That's literally the cost of a second house!</p>
                <p style="margin-top: 15px;">The difference between a good and bad credit score can determine whether you build wealth or stay trapped in debt.</p>
            </div>
        </div>

        <!-- Action Items -->
        <div class="lesson-section">
            <h2><span class="section-icon">‚úÖ</span>Your Action Plan</h2>

            <div class="action-box">
                <h3>üéØ Take Action Now</h3>
                <ul>
                    <li>Check your credit score for free (AnnualCreditReport.com, Credit Karma, or your bank)</li>
                    <li>Identify the factors affecting your score (late payments, high utilization, etc.)</li>
                    <li>Set a specific credit score goal (e.g., reach 700 within 12 months)</li>
                </ul>
            </div>
        </div>

        <!-- Lesson Navigation -->
        <div class="lesson-navigation" id="lessonNav">
            <button class="nav-button" id="prevBtn" onclick="previousSection()">‚Üê Previous</button>
            <div class="progress-indicator">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">Section 1 of 6</div>
            </div>
            <button class="nav-button" id="nextBtn" onclick="nextSection()">Next ‚Üí</button>
        </div>

        <!-- Mini Quiz -->
        <div class="quiz-container" id="quizContainer" style="display: none;">
            <div class="quiz-header">
                <h2>Test Your Knowledge</h2>
                <p>Answer all 3 questions correctly to complete the lesson</p>
            </div>
            <div id="quizQuestions"></div>
            <button class="btn-submit-quiz" id="submitQuiz" onclick="submitQuiz()">Submit Answers</button>
            <div id="quizResult"></div>
        </div>

        <!-- Finish Button -->
        <button class="btn-finish" id="finishBtn" onclick="finishLesson()" disabled>Complete Lesson</button>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>FinanceU</h4>
                    <p>Making financial literacy accessible for everyone.</p>
                </div>
                <div class="footer-section">
                    <h4>Company</h4>
                    <ul>
                        <li><a href="/about">About Us</a></li>
                        <li><a href="/careers">Careers</a></li>
                        <li><a href="/contact">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Support</h4>
                    <ul>
                        <li><a href="/help">Help Center</a></li>
                        <li><a href="/privacy">Privacy Policy</a></li>
                        <li><a href="/terms">Terms of Service</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p style="font-size: 0.85rem; opacity: 0.8; margin-bottom: 10px;">Disclaimer: FinanceU provides educational content only and does not offer financial, legal, or investment advice. Always consult with a qualified professional before making financial decisions.</p>
                <p>&copy; 2025 FinanceU. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="config.js"></script>
    <script src="lesson-completion.js"></script>
    <script src="animations.js"></script>
    <script>
        // Check authentication status and update nav
        async function updateNav() {
            const authButtons = document.getElementById('authButtons');
            const cachedAuth = localStorage.getItem('authState');
            if (cachedAuth) {
                const authState = JSON.parse(cachedAuth);
                authButtons.innerHTML = authState.isLoggedIn
                    ? `<a href="#" onclick="logout(); return false;" class="btn-primary">Logout</a>`
                    : `<a href="login" class="btn-primary">Login</a>`;
                authButtons.style.opacity = '1';
            }
            try {
                const response = await fetch(`${API_URL}/auth/me`, { credentials: 'include' });
                if (response.ok) {
                    localStorage.setItem('authState', JSON.stringify({ isLoggedIn: true }));
                    authButtons.innerHTML = `<a href="#" onclick="logout(); return false;" class="btn-primary">Logout</a>`;
                } else {
                    localStorage.setItem('authState', JSON.stringify({ isLoggedIn: false }));
                    authButtons.innerHTML = `<a href="login" class="btn-primary">Login</a>`;
                }
                authButtons.style.opacity = '1';
            } catch (error) {
                console.log('Not logged in');
                localStorage.setItem('authState', JSON.stringify({ isLoggedIn: false }));
                authButtons.innerHTML = `<a href="login" class="btn-primary">Login</a>`;
                authButtons.style.opacity = '1';
            }
        }

        async function logout() {
            localStorage.removeItem('authState');
            localStorage.removeItem('token');
            localStorage.removeItem('userId');
            try {
                await fetch(`${API_URL}/auth/logout`, {
                    method: 'POST',
                    credentials: 'include'
                });
                window.location.href = '/index.html';
            } catch (error) {
                console.error('Logout error:', error);
                window.location.href = '/index.html';
            }
        }

        // Quiz data
        const quizData = [
            {
                question: "What percentage of your credit score is determined by payment history?",
                options: ["A) 15%", "B) 25%", "C) 35%", "D) 45%"],
                correct: 2
            },
            {
                question: "Which credit score range is considered 'good'?",
                options: ["A) 580-669", "B) 670-739", "C) 740-799", "D) 800-850"],
                correct: 1
            },
            {
                question: "What's the credit score range?",
                options: ["A) 0-1000", "B) 200-900", "C) 300-850", "D) 100-900"],
                correct: 2
            }
        ];

        let userAnswers = [];
        let quizPassed = false;

        function initQuiz() {
            const userId = localStorage.getItem('userId');
            if (!userId || userId === 'null' || userId === 'undefined') {
                console.error('No valid userId found');
                document.getElementById('finishBtn').disabled = true;
                return;
            }

            const quizPassedStatus = localStorage.getItem(`pillar3_lesson1_quiz_passed_${userId}`);
            if (quizPassedStatus === 'true') {
                quizPassed = true;
                document.getElementById('finishBtn').disabled = false;
                document.getElementById('quizContainer').style.display = 'none';
                return;
            }

            renderQuiz();
        }

        function renderQuiz() {
            const questionsContainer = document.getElementById('quizQuestions');
            questionsContainer.innerHTML = '';
            userAnswers = new Array(quizData.length).fill(null);

            quizData.forEach((q, qIndex) => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                questionCard.innerHTML = `
                    <div class="question-text">Question ${qIndex + 1}: ${q.question}</div>
                    ${q.options.map((option, oIndex) => `
                        <div class="answer-option" onclick="selectAnswer(${qIndex}, ${oIndex})">
                            <input type="radio" name="question${qIndex}" value="${oIndex}" style="margin-right: 10px;">
                            ${option}
                        </div>
                    `).join('')}
                `;
                questionsContainer.appendChild(questionCard);
            });

            document.getElementById('submitQuiz').disabled = false;
            document.getElementById('quizResult').innerHTML = '';
        }

        function selectAnswer(questionIndex, optionIndex) {
            userAnswers[questionIndex] = optionIndex;
            const questionCard = document.querySelectorAll('.question-card')[questionIndex];
            const options = questionCard.querySelectorAll('.answer-option');
            options.forEach((opt, idx) => {
                opt.classList.remove('selected');
                if (idx === optionIndex) {
                    opt.classList.add('selected');
                    opt.querySelector('input').checked = true;
                }
            });
        }

        function submitQuiz() {
            if (userAnswers.includes(null)) {
                alert('Please answer all questions before submitting.');
                return;
            }

            let correct = 0;
            quizData.forEach((q, index) => {
                if (userAnswers[index] === q.correct) {
                    correct++;
                }
            });

            const percentage = Math.round((correct / quizData.length) * 100);
            const passed = correct === quizData.length;

            document.querySelectorAll('.question-card').forEach((card, qIndex) => {
                const options = card.querySelectorAll('.answer-option');
                options.forEach((opt, oIndex) => {
                    opt.style.pointerEvents = 'none';
                    if (oIndex === quizData[qIndex].correct) {
                        opt.classList.add('correct');
                    } else if (oIndex === userAnswers[qIndex] && oIndex !== quizData[qIndex].correct) {
                        opt.classList.add('incorrect');
                    }
                });
            });

            const resultDiv = document.getElementById('quizResult');
            if (passed) {
                quizPassed = true;
                const userId = localStorage.getItem('userId');
                localStorage.setItem(`pillar3_lesson1_quiz_passed_${userId}`, 'true');
                document.getElementById('finishBtn').disabled = false;

                resultDiv.innerHTML = `
                    <div class="quiz-result pass">
                        <div class="result-icon">üéâ</div>
                        <div class="result-text" style="color: #10b981;">Perfect Score!</div>
                        <div class="result-score">You got all ${quizData.length} questions correct!</div>
                        <p style="color: var(--text-secondary); font-size: 18px; font-weight: 600;">Excellent! Click "Complete Lesson" to continue.</p>
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `
                    <div class="quiz-result fail">
                        <div class="result-icon">üìö</div>
                        <div class="result-text" style="color: #dc2626;">Not Quite</div>
                        <div class="result-score">You scored ${correct} out of ${quizData.length}</div>
                        <p style="color: var(--text-secondary); margin-bottom: 15px; font-size: 18px; font-weight: 600;">You need all 3 correct. Review the lesson and try again!</p>
                        <button class="btn-submit-quiz" onclick="retryQuiz()">Retry Quiz</button>
                    </div>
                `;
            }

            document.getElementById('submitQuiz').style.display = 'none';
        }

        function retryQuiz() {
            renderQuiz();
            document.getElementById('submitQuiz').style.display = 'block';
        }

        async function finishLesson() {
            if (!quizPassed) {
                alert('Please complete the quiz first!');
                return;
            }
            const success = await completeLesson('pillar3_lesson1', 3, 1);
            if (success) {
                window.location.href = 'pillar3-lessons.html';
            }
        }

        // Multi-screen navigation
        let currentSection = 0;
        const sections = document.querySelectorAll('.lesson-section');
        const totalSections = sections.length;
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const lessonNav = document.getElementById('lessonNav');
        const quizContainer = document.getElementById('quizContainer');

        function showSection(index) {
            // Hide all sections
            sections.forEach(section => section.classList.remove('active'));

            // Show current section
            if (index >= 0 && index < totalSections) {
                sections[index].classList.add('active');
                currentSection = index;

                // Update navigation buttons
                prevBtn.disabled = currentSection === 0;

                // Update progress
                const progress = ((currentSection + 1) / totalSections) * 100;
                progressFill.style.width = progress + '%';
                progressText.textContent = `Section ${currentSection + 1} of ${totalSections}`;

                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function nextSection() {
            if (currentSection < totalSections - 1) {
                showSection(currentSection + 1);
            } else {
                // Show quiz after all sections completed
                lessonNav.style.display = 'none';
                quizContainer.style.display = 'block';
                window.scrollTo({ top: quizContainer.offsetTop - 100, behavior: 'smooth' });
            }
        }

        function previousSection() {
            if (currentSection > 0) {
                showSection(currentSection - 1);
            }
        }

        // Initialize - show first section
        showSection(0);

        updateNav();
        initQuiz();
    </script>
</body>
</html>
