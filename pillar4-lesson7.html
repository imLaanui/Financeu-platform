<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 7 - Avoiding Common Saving Traps - FinanceU</title>
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <link rel="stylesheet" href="styles.css">
    <style>
        .lesson-container { max-width: 800px; margin: 0 auto; padding: 40px 20px; }
        .lesson-header { text-align: center; margin-bottom: 40px; padding: 30px; background: linear-gradient(135deg, #0A1A2F 0%, #1a3a5c 100%); border-radius: 16px; position: relative; overflow: hidden; }
        .lesson-header::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(59, 130, 246, 0.1) 0%, transparent 70%); animation: rotate 20s linear infinite; }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .lesson-header h1 { font-size: 36px; color: white; margin-bottom: 10px; position: relative; z-index: 1; }
        .lesson-header .lesson-number { color: rgba(255, 255, 255, 0.9); font-size: 18px; font-weight: 700; margin-bottom: 5px; position: relative; z-index: 1; text-transform: uppercase; letter-spacing: 2px; }
        .lesson-section { background: white; padding: 30px; border-radius: 12px; margin-bottom: 25px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); position: relative; border-left: 4px solid transparent; transition: all 0.3s ease; }
        .lesson-section:hover { border-left-color: var(--primary-color); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        .lesson-section h2 { color: var(--primary-color); font-size: 24px; margin-bottom: 15px; }
        .lesson-section p { line-height: 1.8; color: var(--text-secondary); margin-bottom: 15px; }
        .lesson-section ul { line-height: 1.8; color: var(--text-secondary); margin-left: 20px; margin-bottom: 15px; }
        .visual-box { background: linear-gradient(135deg, #0A1A2F15 0%, #00A67615 100%); border-left: 4px solid var(--primary-color); padding: 25px; border-radius: 12px; margin: 20px 0; position: relative; box-shadow: 0 2px 8px rgba(59, 130, 246, 0.1); }
        .visual-box h3 { color: var(--primary-color); margin-bottom: 15px; font-size: 18px; font-weight: 700; }
        .mistakes-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 20px 0; }
        .mistake-card { background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); border: 2px solid #dc2626; border-radius: 12px; padding: 20px; text-align: center; transition: all 0.3s; }
        .mistake-icon { font-size: 40px; margin-bottom: 10px; }
        .mistake-title { font-weight: 700; color: #dc2626; font-size: 14px; margin-bottom: 8px; }
        .mistake-desc { font-size: 12px; color: var(--text-secondary); line-height: 1.4; }
        .action-checklist { background: linear-gradient(135deg, #10b98115 0%, #d1fae530 100%); border: 2px solid #10b981; border-radius: 12px; padding: 25px; margin: 20px 0; }
        .checklist-title { color: #10b981; font-size: 20px; font-weight: 700; margin-bottom: 15px; text-align: center; }
        .checklist-item { background: white; border-radius: 8px; padding: 15px; margin-bottom: 10px; display: flex; align-items: center; gap: 12px; cursor: pointer; }
        .checklist-item.checked { background: #d1fae5; opacity: 0.7; }
        .checklist-checkbox { width: 24px; height: 24px; border: 2px solid #10b981; border-radius: 6px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; font-size: 16px; }
        .checklist-item.checked .checklist-checkbox { background: #10b981; color: white; }
        .reflection-box { background: linear-gradient(135deg, #f59e0b20 0%, #fef3c740 100%); border-left: 4px solid #f59e0b; padding: 25px; border-radius: 12px; }
        .reflection-title { color: #f59e0b; font-size: 18px; font-weight: 700; margin-bottom: 10px; }
        .quiz-container { background: linear-gradient(135deg, #0A1A2F15 0%, #00A67615 100%); border: 2px solid var(--primary-color); border-radius: 12px; padding: 30px; margin: 40px 0 30px 0; }
        .quiz-header { text-align: center; margin-bottom: 25px; }
        .quiz-header h2 { color: var(--primary-color); font-size: 28px; margin-bottom: 10px; }
        .question-card { background: white; padding: 25px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); }
        .question-text { font-size: 18px; font-weight: 600; color: var(--text-primary); margin-bottom: 15px; }
        .answer-option { background: #f9fafb; padding: 15px; border: 2px solid #e5e7eb; border-radius: 8px; margin-bottom: 10px; cursor: pointer; transition: all 0.2s; }
        .answer-option:hover { border-color: var(--primary-color); background: #eff6ff; }
        .answer-option.selected { border-color: var(--primary-color); background: #dbeafe; }
        .answer-option.correct { border-color: #10b981; background: #d1fae5; }
        .answer-option.incorrect { border-color: #dc2626; background: #fee2e2; }
        .btn-submit-quiz { display: block; width: 100%; max-width: 300px; margin: 20px auto; padding: 15px; background: var(--primary-color); color: white; border-radius: 8px; font-size: 16px; font-weight: 600; border: none; cursor: pointer; }
        .quiz-result { background: white; padding: 25px; border-radius: 8px; text-align: center; margin-top: 20px; }
        .quiz-result.pass { border: 3px solid #10b981; }
        .quiz-result.fail { border: 3px solid #dc2626; }
        .btn-retry { padding: 12px 24px; background: #f59e0b; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; }
        .btn-finish { display: block; width: 100%; max-width: 400px; margin: 30px auto; padding: 18px; background: var(--primary-color); color: white; text-align: center; border-radius: 8px; font-size: 18px; font-weight: 600; border: none; cursor: pointer; }
        .btn-finish:disabled { background: #9ca3af; cursor: not-allowed; opacity: 0.6; }
        .back-link { display: inline-block; margin-bottom: 20px; color: var(--primary-color); text-decoration: none; font-weight: 600; }
        .lesson-screen { display: none; }
        .lesson-screen.active { display: block; animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .screen-progress { text-align: center; margin-bottom: 20px; padding: 12px 20px; background: linear-gradient(135deg, #0A1A2F15 0%, #00A67615 100%); border-radius: 8px; font-weight: 600; color: var(--primary-color); font-size: 14px; }
        .screen-navigation { display: flex; justify-content: space-between; align-items: center; gap: 15px; margin-top: 30px; padding-top: 20px; border-top: 2px solid #e5e7eb; }
        .btn-nav { padding: 12px 24px; background: var(--primary-color); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; }
        .btn-nav.btn-prev { background: #6b7280; }
        .nav-spacer { width: 120px; }
        .intro-cards { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px; }
        .intro-card { background: linear-gradient(135deg, #0A1A2F15 0%, #00A67615 100%); border-radius: 12px; padding: 20px; text-align: center; }
        .intro-card-icon { font-size: 48px; margin-bottom: 10px; }
        .intro-card h3 { color: var(--primary-color); font-size: 18px; margin-bottom: 8px; font-weight: 700; }
        .intro-card p { color: var(--text-secondary); font-size: 14px; line-height: 1.5; margin: 0; }
        .checkpoint-container { background: linear-gradient(135deg, #E0F2FE 0%, #BAE6FD 100%); border: 2px solid #7DD3FC; border-radius: 12px; padding: 30px; margin: 20px 0; }
        .checkpoint-header h3 { color: #0284C7; font-size: 24px; margin-bottom: 8px; text-align: center; }
        .checkpoint-question { background: white; padding: 20px; border-radius: 8px; margin-bottom: 15px; }
        .checkpoint-option { background: #f9fafb; padding: 15px; border: 2px solid #e5e7eb; border-radius: 8px; margin-bottom: 10px; cursor: pointer; display: flex; align-items: center; gap: 10px; }
        .checkpoint-option.correct { border-color: #10b981; background: #d1fae5; }
        .checkpoint-option.incorrect { border-color: #dc2626; background: #fee2e2; }
        .checkpoint-feedback { background: white; padding: 20px; border-radius: 8px; margin-top: 20px; display: none; }
        .checkpoint-feedback.show { display: block; }
        .checkpoint-feedback.correct { border-left: 4px solid #10b981; }
        .checkpoint-feedback.incorrect { border-left: 4px solid #f59e0b; }
        .btn-continue { display: none; width: 100%; max-width: 300px; margin: 20px auto; padding: 15px; background: var(--primary-color); color: white; border-radius: 8px; font-size: 16px; font-weight: 600; border: none; cursor: pointer; }
        .btn-continue.show { display: block; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-wrapper">
                <div class="logo"><a href="/" style="color: inherit; text-decoration: none;">Finance<span class="logo-accent">U</span></a></div>
                <ul class="nav-links">
                    <li><a href="/">Home</a></li>
                    <li><a href="dashboard">Dashboard</a></li>
                    <li id="authButtons" style="opacity: 0;"></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="lesson-container">
        <a href="/pillar4-lessons" class="back-link">‚Üê Back to Pillar 4 Lessons</a>
        <div class="lesson-header">
            <div class="lesson-number">LESSON 7</div>
            <h1>The 50/30/20 Budget Rule</h1>
        </div>

        <!-- Screen 1 -->
        <div class="lesson-screen active" data-screen="1">
            <div class="screen-progress">Screen 1 of 8</div>
            <div class="lesson-section">
                <h2>The 50/30/20 Budget Rule</h2>
                <div class="intro-cards">
                    <div class="intro-card">
                        <div class="intro-card-icon">üìä</div>
                        <h3>The Problem</h3>
                        <p>Most people don't know how much to allocate to different spending categories</p>
                    </div>
                    <div class="intro-card">
                        <div class="intro-card-icon">üí°</div>
                        <h3>Why It Matters</h3>
                        <p>A simple budgeting framework helps you balance needs, wants, and savings</p>
                    </div>
                    <div class="intro-card">
                        <div class="intro-card-icon">üéØ</div>
                        <h3>What You'll Learn</h3>
                        <p>How to split your income: 50% needs, 30% wants, 20% savings</p>
                    </div>
                </div>
            </div>
            <div class="screen-navigation">
                <div class="nav-spacer"></div>
                <button class="btn-nav" onclick="nextScreen()">Next ‚Üí</button>
            </div>
        </div>

        <!-- Screen 2 -->
        <div class="lesson-screen" data-screen="2">
            <div class="screen-progress">Screen 2 of 8</div>
            <div class="lesson-section">
                <h2>Core Concept: The 50/30/20 Framework</h2>
                <p><strong>The 50/30/20 rule is a simple budgeting method that divides your after-tax income into three categories:</strong></p>
                <div class="visual-box">
                    <h3>50% - Needs (Essentials)</h3>
                    <p>Housing, utilities, groceries, transportation, insurance, minimum debt payments. These are things you MUST have to survive.</p>
                </div>
                <div class="visual-box">
                    <h3>30% - Wants (Discretionary)</h3>
                    <p>Dining out, entertainment, hobbies, subscriptions, vacations, shopping. These enhance your life but aren't essential.</p>
                </div>
                <div class="visual-box">
                    <h3>20% - Savings & Debt Payoff</h3>
                    <p>Emergency fund, retirement accounts, investments, extra debt payments beyond minimums. This is your future security.</p>
                </div>
            </div>
            <div class="screen-navigation">
                <button class="btn-nav btn-prev" onclick="previousScreen()">‚Üê Previous</button>
                <button class="btn-nav" onclick="nextScreen()">Next ‚Üí</button>
            </div>
        </div>

        <!-- Screen 3: Checkpoint 1 -->
        <div class="lesson-screen" data-screen="3">
            <div class="screen-progress">Screen 3 of 8</div>
            <div class="checkpoint-container">
                <div class="checkpoint-header">
                    <h3>Quick Check</h3>
                </div>
                <div class="checkpoint-question">
                    <div class="question-text">Which of these would be categorized as a "need"?</div>
                    <div class="checkpoint-option" onclick="checkCheckpoint1(0)">
                        <input type="radio" name="checkpoint1"><span>A) Netflix subscription</span>
                    </div>
                    <div class="checkpoint-option" onclick="checkCheckpoint1(1)">
                        <input type="radio" name="checkpoint1"><span>B) Rent payment</span>
                    </div>
                    <div class="checkpoint-option" onclick="checkCheckpoint1(2)">
                        <input type="radio" name="checkpoint1"><span>C) Concert tickets</span>
                    </div>
                    <div class="checkpoint-option" onclick="checkCheckpoint1(3)">
                        <input type="radio" name="checkpoint1"><span>D) Designer clothes</span>
                    </div>
                </div>
                <div class="checkpoint-feedback" id="checkpoint1-feedback">
                    <div class="checkpoint-feedback-title"></div>
                    <div class="checkpoint-explanation"></div>
                </div>
                <button class="btn-continue" id="checkpoint1-continue" onclick="nextScreen()">Continue ‚Üí</button>
            </div>
            <div class="screen-navigation">
                <button class="btn-nav btn-prev" onclick="previousScreen()">‚Üê Previous</button>
                <div class="nav-spacer"></div>
            </div>
        </div>

        <!-- Screen 4 -->
        <div class="lesson-screen" data-screen="4">
            <div class="screen-progress">Screen 4 of 8</div>
            <div class="lesson-section">
                <h2>Example: $3,000 Monthly Income</h2>
                <div class="visual-box">
                    <h3>50% Needs = $1,500</h3>
                    <ul>
                        <li>Rent: $900</li>
                        <li>Groceries: $300</li>
                        <li>Utilities: $100</li>
                        <li>Transportation: $150</li>
                        <li>Insurance: $50</li>
                    </ul>
                </div>
                <div class="visual-box">
                    <h3>30% Wants = $900</h3>
                    <ul>
                        <li>Dining out: $200</li>
                        <li>Entertainment: $150</li>
                        <li>Subscriptions: $50</li>
                        <li>Shopping: $300</li>
                        <li>Fun money: $200</li>
                    </ul>
                </div>
                <div class="visual-box">
                    <h3>20% Savings = $600</h3>
                    <ul>
                        <li>Emergency fund: $300</li>
                        <li>Retirement: $200</li>
                        <li>Extra debt payment: $100</li>
                    </ul>
                </div>
            </div>
            <div class="screen-navigation">
                <button class="btn-nav btn-prev" onclick="previousScreen()">‚Üê Previous</button>
                <button class="btn-nav" onclick="nextScreen()">Next ‚Üí</button>
            </div>
        </div>

        <!-- Screen 5: Checkpoint 2 -->
        <div class="lesson-screen" data-screen="5">
            <div class="screen-progress">Screen 5 of 8</div>
            <div class="checkpoint-container">
                <div class="checkpoint-header">
                    <h3>Apply What You Learned</h3>
                </div>
                <div class="checkpoint-question">
                    <div class="question-text">If you earn $2,000/month after taxes, how much should you allocate to savings?</div>
                    <div class="checkpoint-option" onclick="checkCheckpoint2(0)">
                        <input type="radio" name="checkpoint2"><span>A) $200</span>
                    </div>
                    <div class="checkpoint-option" onclick="checkCheckpoint2(1)">
                        <input type="radio" name="checkpoint2"><span>B) $400</span>
                    </div>
                    <div class="checkpoint-option" onclick="checkCheckpoint2(2)">
                        <input type="radio" name="checkpoint2"><span>C) $600</span>
                    </div>
                    <div class="checkpoint-option" onclick="checkCheckpoint2(3)">
                        <input type="radio" name="checkpoint2"><span>D) $1,000</span>
                    </div>
                </div>
                <div class="checkpoint-feedback" id="checkpoint2-feedback">
                    <div class="checkpoint-feedback-title"></div>
                    <div class="checkpoint-explanation"></div>
                </div>
                <button class="btn-continue" id="checkpoint2-continue" onclick="nextScreen()">Continue ‚Üí</button>
            </div>
            <div class="screen-navigation">
                <button class="btn-nav btn-prev" onclick="previousScreen()">‚Üê Previous</button>
                <div class="nav-spacer"></div>
            </div>
        </div>

        <!-- Screen 6: Common Mistakes -->
        <div class="lesson-screen" data-screen="6">
            <div class="screen-progress">Screen 6 of 8</div>
            <div class="lesson-section">
                <h2>Avoid These Mistakes</h2>
                <div class="mistakes-grid">
                    <div class="mistake-card">
                        <div class="mistake-icon">üé≠</div>
                        <div class="mistake-title">Mislabeling Wants as Needs</div>
                        <div class="mistake-desc">Premium cable isn't a need‚Äîbasic shelter is</div>
                    </div>
                    <div class="mistake-card">
                        <div class="mistake-icon">üì±</div>
                        <div class="mistake-title">Too Many Subscriptions</div>
                        <div class="mistake-desc">$10 here, $15 there‚Äîthey add up fast</div>
                    </div>
                    <div class="mistake-card">
                        <div class="mistake-icon">üí≥</div>
                        <div class="mistake-title">Ignoring the 20% Rule</div>
                        <div class="mistake-desc">Skipping savings means no financial security</div>
                    </div>
                    <div class="mistake-card">
                        <div class="mistake-icon">‚öñÔ∏è</div>
                        <div class="mistake-title">Being Too Rigid</div>
                        <div class="mistake-desc">Adjust percentages based on your situation</div>
                    </div>
                </div>
            </div>
            <div class="screen-navigation">
                <button class="btn-nav btn-prev" onclick="previousScreen()">‚Üê Previous</button>
                <button class="btn-nav" onclick="nextScreen()">Next ‚Üí</button>
            </div>
        </div>

        <!-- Screen 7: Action Plan -->
        <div class="lesson-screen" data-screen="7">
            <div class="screen-progress">Screen 7 of 8</div>
            <div class="lesson-section">
                <div class="action-checklist">
                    <div class="checklist-title">üéØ Your Action Plan</div>
                    <div class="checklist-item" onclick="toggleChecklistItem(this)">
                        <div class="checklist-checkbox"></div>
                        <div>Calculate your monthly after-tax income</div>
                    </div>
                    <div class="checklist-item" onclick="toggleChecklistItem(this)">
                        <div class="checklist-checkbox"></div>
                        <div>List all expenses and categorize as needs, wants, or savings</div>
                    </div>
                    <div class="checklist-item" onclick="toggleChecklistItem(this)">
                        <div class="checklist-checkbox"></div>
                        <div>Calculate current percentages for each category</div>
                    </div>
                    <div class="checklist-item" onclick="toggleChecklistItem(this)">
                        <div class="checklist-checkbox"></div>
                        <div>Adjust spending to align with 50/30/20 (or your custom split)</div>
                    </div>
                </div>
                <div class="reflection-box">
                    <div class="reflection-title">Quick Reflection</div>
                    <p>Are your current percentages close to 50/30/20? If not, what's one area where you can make an adjustment?</p>
                </div>
            </div>
            <div class="screen-navigation">
                <button class="btn-nav btn-prev" onclick="previousScreen()">‚Üê Previous</button>
                <button class="btn-nav" onclick="nextScreen()">Next ‚Üí</button>
            </div>
        </div>

        <!-- Screen 8: Quiz -->
        <div class="lesson-screen" data-screen="8">
            <div class="screen-progress">Screen 8 of 8</div>
            <div class="quiz-container" id="quizContainer">
                <div class="quiz-header">
                    <h2>Lesson Quiz</h2>
                    <p>Answer all questions correctly to unlock the next lesson!</p>
                </div>
                <div id="quizQuestions"></div>
                <button class="btn-submit-quiz" id="submitQuiz" onclick="submitQuiz()">Submit Quiz</button>
                <div id="quizResult"></div>
            </div>
            <button class="btn-finish" id="finishBtn" onclick="finishLesson()" disabled>Finish Lesson</button>
            <div class="screen-navigation">
                <button class="btn-nav btn-prev" onclick="previousScreen()">‚Üê Previous</button>
                <div class="nav-spacer"></div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>FinanceU</h4>
                    <p>Making financial literacy accessible for everyone.</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 FinanceU. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="config.js"></script>
    <script src="lesson-completion.js"></script>
    <script src="animations.js"></script>
    <script>
        async function updateNav() {
            const authButtons = document.getElementById('authButtons');
            const cachedAuth = localStorage.getItem('authState');
            if (cachedAuth) {
                const authState = JSON.parse(cachedAuth);
                authButtons.innerHTML = authState.isLoggedIn ? `<a href="#" onclick="logout(); return false;" class="btn-primary">Logout</a>` : `<a href="login" class="btn-primary">Login</a>`;
                authButtons.style.opacity = '1';
            }
            try {
                const response = await fetch(`${API_URL}/auth/me`, { credentials: 'include' });
                if (response.ok) {
                    localStorage.setItem('authState', JSON.stringify({ isLoggedIn: true }));
                    authButtons.innerHTML = `<a href="#" onclick="logout(); return false;" class="btn-primary">Logout</a>`;
                } else {
                    localStorage.setItem('authState', JSON.stringify({ isLoggedIn: false }));
                    authButtons.innerHTML = `<a href="login" class="btn-primary">Login</a>`;
                }
                authButtons.style.opacity = '1';
            } catch (error) {
                localStorage.setItem('authState', JSON.stringify({ isLoggedIn: false }));
                authButtons.innerHTML = `<a href="login" class="btn-primary">Login</a>`;
                authButtons.style.opacity = '1';
            }
        }
        async function logout() {
            localStorage.removeItem('authState');
            localStorage.removeItem('token');
            localStorage.removeItem('userId');
            try {
                await fetch(`${API_URL}/auth/logout`, { method: 'POST', credentials: 'include' });
                window.location.href = '/index.html';
            } catch (error) {
                window.location.href = '/index.html';
            }
        }

        const quizData = [
            { question: "In the 50/30/20 rule, what percentage should go to needs?", options: ["30%", "50%", "20%", "40%"], correct: 1 },
            { question: "Which category does 'dining out' fall under?", options: ["Needs", "Wants", "Savings", "Emergency fund"], correct: 1 },
            { question: "If you earn $4,000/month, how much should go to savings according to the 50/30/20 rule?", options: ["$400", "$600", "$800", "$1,000"], correct: 2 }
        ];

        let userAnswers = [];
        let quizPassed = false;

        function initQuiz() {
            const userId = localStorage.getItem('userId');
            if (!userId || userId === 'null' || userId === 'undefined') {
                document.getElementById('finishBtn').disabled = true;
                return;
            }
            const quizPassedStatus = localStorage.getItem(`pillar4_lesson7_quiz_passed_${userId}`);
            if (quizPassedStatus === 'true') {
                quizPassed = true;
                document.getElementById('finishBtn').disabled = false;
                document.getElementById('quizContainer').style.display = 'none';
                return;
            }
            renderQuiz();
        }

        function renderQuiz() {
            const questionsContainer = document.getElementById('quizQuestions');
            questionsContainer.innerHTML = '';
            userAnswers = new Array(quizData.length).fill(null);
            quizData.forEach((q, qIndex) => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                questionCard.innerHTML = `
                    <div class="question-text">Question ${qIndex + 1}: ${q.question}</div>
                    ${q.options.map((option, oIndex) => `
                        <div class="answer-option" onclick="selectAnswer(${qIndex}, ${oIndex})">
                            <input type="radio" name="question${qIndex}" value="${oIndex}" style="margin-right: 10px;">${option}
                        </div>
                    `).join('')}
                `;
                questionsContainer.appendChild(questionCard);
            });
        }

        function selectAnswer(questionIndex, optionIndex) {
            userAnswers[questionIndex] = optionIndex;
            const questionCard = document.querySelectorAll('.question-card')[questionIndex];
            const options = questionCard.querySelectorAll('.answer-option');
            options.forEach((opt, idx) => {
                opt.classList.remove('selected');
                if (idx === optionIndex) {
                    opt.classList.add('selected');
                    opt.querySelector('input').checked = true;
                }
            });
        }

        function submitQuiz() {
            if (userAnswers.includes(null)) {
                alert('Please answer all questions before submitting.');
                return;
            }
            let correct = 0;
            quizData.forEach((q, index) => {
                if (userAnswers[index] === q.correct) correct++;
            });
            const percentage = Math.round((correct / quizData.length) * 100);
            const passed = percentage === 100;
            document.querySelectorAll('.question-card').forEach((card, qIndex) => {
                const options = card.querySelectorAll('.answer-option');
                options.forEach((opt, oIndex) => {
                    opt.style.pointerEvents = 'none';
                    if (oIndex === quizData[qIndex].correct) opt.classList.add('correct');
                    else if (oIndex === userAnswers[qIndex] && oIndex !== quizData[qIndex].correct) opt.classList.add('incorrect');
                });
            });
            const resultDiv = document.getElementById('quizResult');
            if (passed) {
                quizPassed = true;
                const userId = localStorage.getItem('userId');
                localStorage.setItem(`pillar4_lesson7_quiz_passed_${userId}`, 'true');
                document.getElementById('finishBtn').disabled = false;
                resultDiv.innerHTML = `<div class="quiz-result pass"><div style="font-size: 48px;">üéâ</div><div style="font-size: 24px; font-weight: 700; color: #10b981;">Quiz Passed!</div><p>Great job! You can now finish the lesson.</p></div>`;
            } else {
                resultDiv.innerHTML = `<div class="quiz-result fail"><div style="font-size: 48px;">üìö</div><div style="font-size: 24px; font-weight: 700; color: #dc2626;">Not quite there yet</div><p>You need 100% to pass. Review and try again!</p><button class="btn-retry" onclick="retryQuiz()">Retry Quiz</button></div>`;
            }
            document.getElementById('submitQuiz').style.display = 'none';
        }

        function retryQuiz() {
            renderQuiz();
            document.getElementById('submitQuiz').style.display = 'block';
        }

        async function finishLesson() {
            if (!quizPassed) {
                alert('Please complete the quiz first!');
                return;
            }
            const success = await completeLesson('pillar4_lesson7', 4, 2);
            if (success) window.location.href = 'pillar4-lessons.html';
        }

        let currentScreen = 1;
        function showScreen(screenNumber) {
            document.querySelectorAll('.lesson-screen').forEach(screen => screen.classList.remove('active'));
            const targetScreen = document.querySelector(`.lesson-screen[data-screen="${screenNumber}"]`);
            if (targetScreen) {
                targetScreen.classList.add('active');
                currentScreen = screenNumber;
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }
        function nextScreen() { if (currentScreen < 8) showScreen(currentScreen + 1); }
        function previousScreen() { if (currentScreen > 1) showScreen(currentScreen - 1); }

        let checkpoint1Answered = false;
        function checkCheckpoint1(selected) {
            if (checkpoint1Answered) return;
            checkpoint1Answered = true;
            const correct = 1;
            document.querySelectorAll('[name="checkpoint1"]').forEach((radio, index) => {
                const optionDiv = radio.parentElement;
                optionDiv.style.pointerEvents = 'none';
                if (index === correct) optionDiv.classList.add('correct');
                else if (index === selected) optionDiv.classList.add('incorrect');
                if (index === selected) radio.checked = true;
            });
            const feedback = document.getElementById('checkpoint1-feedback');
            feedback.querySelector('.checkpoint-feedback-title').textContent = selected === correct ? 'Correct!' : 'Not quite!';
            feedback.querySelector('.checkpoint-explanation').textContent = 'Rent is a need‚Äîyou must have shelter. Netflix, concerts, and designer clothes are wants.';
            feedback.classList.add('show', selected === correct ? 'correct' : 'incorrect');
            document.getElementById('checkpoint1-continue').classList.add('show');
        }

        let checkpoint2Answered = false;
        function checkCheckpoint2(selected) {
            if (checkpoint2Answered) return;
            checkpoint2Answered = true;
            const correct = 1;
            document.querySelectorAll('[name="checkpoint2"]').forEach((radio, index) => {
                const optionDiv = radio.parentElement;
                optionDiv.style.pointerEvents = 'none';
                if (index === correct) optionDiv.classList.add('correct');
                else if (index === selected) optionDiv.classList.add('incorrect');
                if (index === selected) radio.checked = true;
            });
            const feedback = document.getElementById('checkpoint2-feedback');
            feedback.querySelector('.checkpoint-feedback-title').textContent = selected === correct ? 'Excellent!' : 'Not quite!';
            feedback.querySelector('.checkpoint-explanation').textContent = '20% of $2,000 = $400. This should go to savings and debt payoff.';
            feedback.classList.add('show', selected === correct ? 'correct' : 'incorrect');
            document.getElementById('checkpoint2-continue').classList.add('show');
        }

        function toggleChecklistItem(item) {
            item.classList.toggle('checked');
            const checkbox = item.querySelector('.checklist-checkbox');
            checkbox.textContent = item.classList.contains('checked') ? '‚úì' : '';
        }

        updateNav();
        initQuiz();
        showScreen(1);
    </script>
</body>
</html>
