<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pillar 2 Final Quiz - FinanceU</title>
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <link rel="icon" type="image/svg+xml" sizes="16x16" href="assets/favicon-16x16.svg">
    <link rel="icon" type="image/svg+xml" sizes="32x32" href="assets/favicon-32x32.svg">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/apple-touch-icon.svg">
    <link rel="stylesheet" href="styles.css">
    <style>
        .quiz-container { max-width: 900px; margin: 0 auto; padding: 40px 20px; }
        .quiz-header { text-align: center; margin-bottom: 40px; padding-bottom: 20px; border-bottom: 3px solid var(--primary-color); }
        .quiz-header h1 { font-size: 36px; color: var(--text-primary); margin-bottom: 10px; }
        .quiz-progress { background: #f3f4f6; padding: 15px; border-radius: 8px; margin-bottom: 30px; text-align: center; font-weight: 600; color: var(--text-secondary); }
        .question-card { background: white; padding: 30px; border-radius: 12px; margin-bottom: 25px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); }
        .question-number { color: var(--primary-color); font-weight: 600; margin-bottom: 10px; font-size: 14px; }
        .question-text { font-size: 18px; font-weight: 600; color: var(--text-primary); margin-bottom: 20px; line-height: 1.6; }
        .answer-options { display: flex; flex-direction: column; gap: 12px; }
        .answer-option { padding: 15px 20px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 12px; }
        .answer-option:hover { border-color: var(--primary-color); background: #f9fafb; }
        .answer-option input[type="radio"] { width: 20px; height: 20px; cursor: pointer; }
        .answer-option label { cursor: pointer; flex: 1; color: var(--text-secondary); }
        .btn-submit-quiz { display: block; width: 100%; max-width: 400px; margin: 30px auto; padding: 18px; background: var(--primary-color); color: white; text-align: center; border-radius: 8px; font-size: 18px; font-weight: 600; transition: background 0.2s; border: none; cursor: pointer; }
        .btn-submit-quiz:hover { background: #050f1a; }
        .btn-submit-quiz:disabled { background: #d1d5db; cursor: not-allowed; }
        .result-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 1000; align-items: center; justify-content: center; }
        .result-content { background: white; padding: 40px; border-radius: 16px; max-width: 500px; width: 90%; text-align: center; }
        .result-content.pass { border-top: 8px solid #00A676; }
        .result-content.fail { border-top: 8px solid #ef4444; }
        .result-score { font-size: 48px; font-weight: 700; margin: 20px 0; }
        .result-score.pass { color: #00A676; }
        .result-score.fail { color: #ef4444; }
        .result-message { font-size: 20px; font-weight: 600; margin-bottom: 10px; }
        .result-details { color: var(--text-secondary); margin-bottom: 30px; }
        .btn-result { padding: 15px 30px; border-radius: 8px; font-weight: 600; text-decoration: none; display: inline-block; margin: 0 10px; }
        .btn-retry { background: #ef4444; color: white; }
        .btn-continue { background: var(--primary-color); color: white; }
        .back-link { display: inline-block; margin-bottom: 20px; color: var(--primary-color); text-decoration: none; font-weight: 600; }
        .back-link:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-wrapper">
                <div class="logo"><a href="/" style="color: inherit; text-decoration: none;">Finance<span class="logo-accent">U</span></a></div>
                <ul class="nav-links">
                    <li><a href="/">Home</a></li>
                    <li><a href="dashboard">Dashboard</a></li>
                    <li id="authButtons" style="opacity: 0;">
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="quiz-container">
        <a href="/pillar2-lessons" class="back-link">‚Üê Back to Pillar 2 Lessons</a>

        <div class="quiz-header">
            <h1>Pillar 2 Final Quiz</h1>
            <p style="color: var(--text-secondary);">Test your knowledge of Budgeting and Saving</p>
            <p style="color: var(--text-secondary); margin-top: 10px;">16 questions ‚Ä¢ 80% to pass</p>
        </div>

        <div class="quiz-progress" id="progress">
            Question <span id="currentQ">0</span> of <span id="totalQ">16</span>
        </div>

        <form id="quizForm">
            <!-- Questions will be inserted here by JavaScript -->
        </form>

        <button type="button" class="btn-submit-quiz" id="submitBtn" onclick="submitQuiz()">Submit Quiz</button>
    </div>

    <div class="result-modal" id="resultModal">
        <div class="result-content" id="resultContent">
            <h2 class="result-message" id="resultMessage"></h2>
            <div class="result-score" id="resultScore"></div>
            <p class="result-details" id="resultDetails"></p>
            <div>
                <a href="/pillar2-quiz" class="btn-result btn-retry" id="retryBtn" style="display: none;">Retry Quiz</a>
                <a href="/pillar2-lessons" class="btn-result btn-continue">Back to Lessons</a>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>FinanceU</h4>
                    <p>Making financial literacy accessible for everyone.</p>
                </div>
                <div class="footer-section">
                    <h4>Company</h4>
                    <ul>
                        <li><a href="/about">About Us</a></li>
                        <li><a href="/careers">Careers</a></li>
                        <li><a href="/contact">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Support</h4>
                    <ul>
                        <li><a href="/help">Help Center</a></li>
                        <li><a href="/privacy">Privacy Policy</a></li>
                        <li><a href="/terms">Terms of Service</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p style="font-size: 0.85rem; opacity: 0.8; margin-bottom: 10px;">Disclaimer: FinanceU provides educational content only and does not offer financial, legal, or investment advice. Always consult with a qualified professional before making financial decisions.</p>
                <p>&copy; 2025 FinanceU. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="config.js"></script>
    <script src="animations.js"></script>
    <script>
        const questions = [
            // Lesson 1: Creating Your First Budget
            { lesson: 1, question: "What is the main purpose of a budget?", answers: ["To restrict your spending", "To plan and control where your money goes", "To impress your bank", "To make you feel guilty"], correct: 1 },
            { lesson: 1, question: "What is the basic budgeting formula?", answers: ["Income + Expenses = Savings", "Income - Expenses = What's Left", "Expenses - Income = Debt", "Income √∑ Expenses = Budget"], correct: 1 },

            // Lesson 2: The 50/30/20 Rule
            { lesson: 2, question: "In the 50/30/20 rule, what percentage goes to needs?", answers: ["30%", "20%", "50%", "60%"], correct: 2 },
            { lesson: 2, question: "Which category does 'rent' belong to in the 50/30/20 rule?", answers: ["Wants", "Needs", "Savings", "Debt"], correct: 1 },

            // Lesson 3: Building an Emergency Fund
            { lesson: 3, question: "What is the recommended first emergency fund goal?", answers: ["$500", "$1,000", "$5,000", "$10,000"], correct: 1 },
            { lesson: 3, question: "How many months of expenses should a full emergency fund cover?", answers: ["1-2 months", "3-6 months", "12 months", "24 months"], correct: 1 },

            // Lesson 4: Saving Strategies That Work
            { lesson: 4, question: "What does 'pay yourself first' mean?", answers: ["Give yourself a salary", "Save money before spending on anything else", "Pay yourself a bonus", "Buy things you want first"], correct: 1 },
            { lesson: 4, question: "What is the 52-week savings challenge?", answers: ["Save $52 every week", "Save for 52 weeks straight", "Save $1 week 1, $2 week 2, increasing weekly", "Save 52% of your income"], correct: 2 },

            // Lesson 5: Cutting Expenses Without Sacrifice
            { lesson: 5, question: "Which expense reduction typically saves the most money?", answers: ["Skipping one coffee per week", "Negotiating recurring monthly bills", "Using coupons occasionally", "Walking instead of driving once"], correct: 1 },
            { lesson: 5, question: "What is the benefit of using generic brands?", answers: ["They taste better", "Same quality at lower prices", "They're healthier", "They're more convenient"], correct: 1 },

            // Lesson 6: Automating Your Savings
            { lesson: 6, question: "When should automatic savings transfers occur?", answers: ["At the end of the month", "Randomly throughout the month", "Right after you get paid", "Only when you remember"], correct: 2 },
            { lesson: 6, question: "Why is automation better than manual saving?", answers: ["It earns more interest", "It removes the decision and makes saving consistent", "Banks prefer it", "It's required by law"], correct: 1 },

            // Lesson 7: Short-term vs. Long-term Savings
            { lesson: 7, question: "Where should you keep savings for a vacation in 6 months?", answers: ["Stock market", "High-yield savings account", "Under your mattress", "Retirement account"], correct: 1 },
            { lesson: 7, question: "What is the main risk of investing money you need in 1 year?", answers: ["Too much growth", "Market volatility could reduce its value", "It's too complicated", "Banks won't allow it"], correct: 1 },

            // Lesson 8: Avoiding Budget Pitfalls
            { lesson: 8, question: "What should you do after overspending in one category?", answers: ["Give up on budgeting", "Adjust and keep going", "Start over next year", "Ignore it"], correct: 1 },
            { lesson: 8, question: "How should you handle annual expenses like car insurance in your budget?", answers: ["Wait until they're due", "Divide by 12 and budget monthly", "Put them on credit cards", "Don't budget for them"], correct: 1 }
        ];

        // Shuffle questions
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        const shuffledQuestions = shuffleArray(questions);

        // Render questions
        function renderQuestions() {
            const form = document.getElementById('quizForm');
            shuffledQuestions.forEach((q, index) => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                questionCard.innerHTML = `
                    <div class="question-number">Question ${index + 1} of 16</div>
                    <div class="question-text">${q.question}</div>
                    <div class="answer-options">
                        ${q.answers.map((answer, i) => `
                            <div class="answer-option">
                                <input type="radio" id="q${index}_a${i}" name="q${index}" value="${i}" required>
                                <label for="q${index}_a${i}">${answer}</label>
                            </div>
                        `).join('')}
                    </div>
                `;
                form.appendChild(questionCard);
            });

            document.getElementById('totalQ').textContent = shuffledQuestions.length;
            updateProgress();
        }

        // Update progress
        function updateProgress() {
            const answered = document.querySelectorAll('input[type="radio"]:checked').length;
            document.getElementById('currentQ').textContent = answered;
        }

        // Add event listeners for progress tracking
        document.addEventListener('change', (e) => {
            if (e.target.type === 'radio') {
                updateProgress();
            }
        });

        // Submit quiz
        function submitQuiz() {
            const form = document.getElementById('quizForm');
            if (!form.checkValidity()) {
                alert('Please answer all questions before submitting.');
                return;
            }

            let correct = 0;
            shuffledQuestions.forEach((q, index) => {
                const selected = document.querySelector(`input[name="q${index}"]:checked`);
                if (selected && parseInt(selected.value) === q.correct) {
                    correct++;
                }
            });

            const percentage = Math.round((correct / shuffledQuestions.length) * 100);
            const passed = percentage >= 80;

            // Show results
            const modal = document.getElementById('resultModal');
            const content = document.getElementById('resultContent');
            const message = document.getElementById('resultMessage');
            const score = document.getElementById('resultScore');
            const details = document.getElementById('resultDetails');
            const retryBtn = document.getElementById('retryBtn');

            if (passed) {
                content.className = 'result-content pass';
                message.textContent = 'Congratulations! You Passed! üéâ';
                score.className = 'result-score pass';
                score.textContent = `${percentage}%`;
                details.textContent = `You answered ${correct} out of ${shuffledQuestions.length} questions correctly.`;
                retryBtn.style.display = 'none';

                // Save completion with user-specific keys
                const userId = localStorage.getItem('userId');
                localStorage.setItem(`pillar2_quiz_completed_${userId}`, 'true');
                localStorage.setItem(`pillar2_quiz_score_${userId}`, percentage);
            } else {
                content.className = 'result-content fail';
                message.textContent = 'Not Quite There Yet';
                score.className = 'result-score fail';
                score.textContent = `${percentage}%`;
                details.textContent = `You answered ${correct} out of ${shuffledQuestions.length} questions correctly. You need 80% to pass. Review the lessons and try again!`;
                retryBtn.style.display = 'inline-block';
            }

            modal.style.display = 'flex';
        }

        // Auth nav function
        async function updateNav() {
            const authButtons = document.getElementById('authButtons');
            const cachedAuth = localStorage.getItem('authState');
            if (cachedAuth) {
                const authState = JSON.parse(cachedAuth);
                authButtons.innerHTML = authState.isLoggedIn
                    ? `<a href="#" onclick="logout(); return false;" class="btn-primary">Logout</a>`
                    : `<a href="login" class="btn-primary">Login</a>`;
                authButtons.style.opacity = '1';
            }
            try {
                const response = await fetch(`${API_URL}/auth/me`, { credentials: 'include' });
                if (response.ok) {
                    localStorage.setItem('authState', JSON.stringify({ isLoggedIn: true }));
                    authButtons.innerHTML = `<a href="#" onclick="logout(); return false;" class="btn-primary">Logout</a>`;
                } else {
                    localStorage.setItem('authState', JSON.stringify({ isLoggedIn: false }));
                    authButtons.innerHTML = `<a href="login" class="btn-primary">Login</a>`;
                }
                authButtons.style.opacity = '1';
            } catch (error) {
                console.log('Not logged in');
                localStorage.setItem('authState', JSON.stringify({ isLoggedIn: false }));
                authButtons.innerHTML = `<a href="login" class="btn-primary">Login</a>`;
                authButtons.style.opacity = '1';
            }
        }

        async function logout() {
            // Clear auth data only - keep user-specific progress data
            localStorage.removeItem('authState');
            localStorage.removeItem('token');
            localStorage.removeItem('userId');

            try {
                await fetch(`${API_URL}/auth/logout`, {
                    method: 'POST',
                    credentials: 'include'
                });
                window.location.href = '/index.html';
            } catch (error) {
                console.error('Logout error:', error);
                window.location.href = '/index.html';
            }
        }

        // Initialize
        renderQuestions();
        updateNav();
    </script>
</body>
</html>
