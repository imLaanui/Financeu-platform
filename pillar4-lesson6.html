<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 6 - Sinking Funds Explained - FinanceU</title>
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <link rel="stylesheet" href="styles.css">
    <style>
        .lesson-container { max-width: 800px; margin: 0 auto; padding: 40px 20px; }
        .lesson-header { text-align: center; margin-bottom: 40px; padding: 30px; background: linear-gradient(135deg, #0A1A2F 0%, #1a3a5c 100%); border-radius: 16px; position: relative; overflow: hidden; }
        .lesson-header::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(59, 130, 246, 0.1) 0%, transparent 70%); animation: rotate 20s linear infinite; }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .lesson-header h1 { font-size: 36px; color: white; margin-bottom: 10px; position: relative; z-index: 1; }
        .lesson-header .lesson-number { color: rgba(255, 255, 255, 0.9); font-size: 18px; font-weight: 700; margin-bottom: 5px; position: relative; z-index: 1; text-transform: uppercase; letter-spacing: 2px; }
        .lesson-section { background: white; padding: 30px; border-radius: 12px; margin-bottom: 25px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); position: relative; border-left: 4px solid transparent; transition: all 0.3s ease; }
        .lesson-section:hover { border-left-color: var(--primary-color); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        .lesson-section h2 { color: var(--primary-color); font-size: 24px; margin-bottom: 15px; }
        .lesson-section p { line-height: 1.8; color: var(--text-secondary); margin-bottom: 15px; }
        .lesson-section ul { line-height: 1.8; color: var(--text-secondary); margin-left: 20px; margin-bottom: 15px; }
        .visual-box { background: linear-gradient(135deg, #0A1A2F15 0%, #00A67615 100%); border-left: 4px solid var(--primary-color); padding: 25px; border-radius: 12px; margin: 20px 0; position: relative; box-shadow: 0 2px 8px rgba(59, 130, 246, 0.1); }
        .visual-box h3 { color: var(--primary-color); margin-bottom: 15px; font-size: 18px; font-weight: 700; }
        .mistakes-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 20px 0; }
        .mistake-card { background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); border: 2px solid #dc2626; border-radius: 12px; padding: 20px; text-align: center; transition: all 0.3s; }
        .mistake-icon { font-size: 40px; margin-bottom: 10px; }
        .mistake-title { font-weight: 700; color: #dc2626; font-size: 14px; margin-bottom: 8px; }
        .mistake-desc { font-size: 12px; color: var(--text-secondary); line-height: 1.4; }
        .action-checklist { background: linear-gradient(135deg, #10b98115 0%, #d1fae530 100%); border: 2px solid #10b981; border-radius: 12px; padding: 25px; margin: 20px 0; }
        .checklist-title { color: #10b981; font-size: 20px; font-weight: 700; margin-bottom: 15px; text-align: center; }
        .checklist-item { background: white; border-radius: 8px; padding: 15px; margin-bottom: 10px; display: flex; align-items: center; gap: 12px; cursor: pointer; }
        .checklist-item.checked { background: #d1fae5; opacity: 0.7; }
        .checklist-checkbox { width: 24px; height: 24px; border: 2px solid #10b981; border-radius: 6px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; font-size: 16px; }
        .checklist-item.checked .checklist-checkbox { background: #10b981; color: white; }
        .reflection-box { background: linear-gradient(135deg, #f59e0b20 0%, #fef3c740 100%); border-left: 4px solid #f59e0b; padding: 25px; border-radius: 12px; }
        .reflection-title { color: #f59e0b; font-size: 18px; font-weight: 700; margin-bottom: 10px; }
        .quiz-container { background: linear-gradient(135deg, #0A1A2F15 0%, #00A67615 100%); border: 2px solid var(--primary-color); border-radius: 12px; padding: 30px; margin: 40px 0 30px 0; }
        .quiz-header { text-align: center; margin-bottom: 25px; }
        .quiz-header h2 { color: var(--primary-color); font-size: 28px; margin-bottom: 10px; }
        .question-card { background: white; padding: 25px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); }
        .question-text { font-size: 18px; font-weight: 600; color: var(--text-primary); margin-bottom: 15px; }
        .answer-option { background: #f9fafb; padding: 15px; border: 2px solid #e5e7eb; border-radius: 8px; margin-bottom: 10px; cursor: pointer; transition: all 0.2s; }
        .answer-option:hover { border-color: var(--primary-color); background: #eff6ff; }
        .answer-option.selected { border-color: var(--primary-color); background: #dbeafe; }
        .answer-option.correct { border-color: #10b981; background: #d1fae5; }
        .answer-option.incorrect { border-color: #dc2626; background: #fee2e2; }
        .btn-submit-quiz { display: block; width: 100%; max-width: 300px; margin: 20px auto; padding: 15px; background: var(--primary-color); color: white; border-radius: 8px; font-size: 16px; font-weight: 600; border: none; cursor: pointer; }
        .quiz-result { background: white; padding: 25px; border-radius: 8px; text-align: center; margin-top: 20px; }
        .quiz-result.pass { border: 3px solid #10b981; }
        .quiz-result.fail { border: 3px solid #dc2626; }
        .btn-retry { padding: 12px 24px; background: #f59e0b; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; }
        .btn-finish { display: block; width: 100%; max-width: 400px; margin: 30px auto; padding: 18px; background: var(--primary-color); color: white; text-align: center; border-radius: 8px; font-size: 18px; font-weight: 600; border: none; cursor: pointer; }
        .btn-finish:disabled { background: #9ca3af; cursor: not-allowed; opacity: 0.6; }
        .back-link { display: inline-block; margin-bottom: 20px; color: var(--primary-color); text-decoration: none; font-weight: 600; }
        .lesson-screen { display: none; }
        .lesson-screen.active { display: block; animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .screen-progress { text-align: center; margin-bottom: 20px; padding: 12px 20px; background: linear-gradient(135deg, #0A1A2F15 0%, #00A67615 100%); border-radius: 8px; font-weight: 600; color: var(--primary-color); font-size: 14px; }
        .screen-navigation { display: flex; justify-content: space-between; align-items: center; gap: 15px; margin-top: 30px; padding-top: 20px; border-top: 2px solid #e5e7eb; }
        .btn-nav { padding: 12px 24px; background: var(--primary-color); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; }
        .btn-nav.btn-prev { background: #6b7280; }
        .nav-spacer { width: 120px; }
        .intro-cards { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px; }
        .intro-card { background: linear-gradient(135deg, #0A1A2F15 0%, #00A67615 100%); border-radius: 12px; padding: 20px; text-align: center; }
        .intro-card-icon { font-size: 48px; margin-bottom: 10px; }
        .intro-card h3 { color: var(--primary-color); font-size: 18px; margin-bottom: 8px; font-weight: 700; }
        .intro-card p { color: var(--text-secondary); font-size: 14px; line-height: 1.5; margin: 0; }
        .checkpoint-container { background: linear-gradient(135deg, #E0F2FE 0%, #BAE6FD 100%); border: 2px solid #7DD3FC; border-radius: 12px; padding: 30px; margin: 20px 0; }
        .checkpoint-header h3 { color: #0284C7; font-size: 24px; margin-bottom: 8px; text-align: center; }
        .checkpoint-question { background: white; padding: 20px; border-radius: 8px; margin-bottom: 15px; }
        .checkpoint-option { background: #f9fafb; padding: 15px; border: 2px solid #e5e7eb; border-radius: 8px; margin-bottom: 10px; cursor: pointer; display: flex; align-items: center; gap: 10px; }
        .checkpoint-option.correct { border-color: #10b981; background: #d1fae5; }
        .checkpoint-option.incorrect { border-color: #dc2626; background: #fee2e2; }
        .checkpoint-feedback { background: white; padding: 20px; border-radius: 8px; margin-top: 20px; display: none; }
        .checkpoint-feedback.show { display: block; }
        .checkpoint-feedback.correct { border-left: 4px solid #10b981; }
        .checkpoint-feedback.incorrect { border-left: 4px solid #f59e0b; }
        .btn-continue { display: none; width: 100%; max-width: 300px; margin: 20px auto; padding: 15px; background: var(--primary-color); color: white; border-radius: 8px; font-size: 16px; font-weight: 600; border: none; cursor: pointer; }
        .btn-continue.show { display: block; }
        .fund-examples { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0; }
        .fund-card { background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border: 2px solid #3b82f6; border-radius: 12px; padding: 20px; text-align: center; }
        .fund-card-icon { font-size: 40px; margin-bottom: 10px; }
        .fund-card-title { font-weight: 700; color: #1e40af; font-size: 14px; margin-bottom: 8px; }
        .fund-card-desc { font-size: 12px; color: var(--text-secondary); line-height: 1.4; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-wrapper">
                <div class="logo"><a href="/" style="color: inherit; text-decoration: none;">Finance<span class="logo-accent">U</span></a></div>
                <ul class="nav-links">
                    <li><a href="/">Home</a></li>
                    <li><a href="dashboard">Dashboard</a></li>
                    <li id="authButtons" style="opacity: 0;"></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="lesson-container">
        <a href="/pillar4-lessons" class="back-link">‚Üê Back to Pillar 4 Lessons</a>
        <div class="lesson-header">
            <div class="lesson-number">LESSON 6</div>
            <h1>Sinking Funds Explained</h1>
        </div>

        <!-- Screen 1 -->
        <div class="lesson-screen active" data-screen="1">
            <div class="screen-progress">Screen 1 of 8</div>
            <div class="lesson-section">
                <h2>Sinking Funds Explained</h2>
                <div class="intro-cards">
                    <div class="intro-card">
                        <div class="intro-card-icon">üéØ</div>
                        <h3>The Problem</h3>
                        <p>Large expenses like vacations or car repairs catch you off guard and derail your budget</p>
                    </div>
                    <div class="intro-card">
                        <div class="intro-card-icon">üí°</div>
                        <h3>Why It Matters</h3>
                        <p>Sinking funds let you save for specific goals without touching your emergency fund</p>
                    </div>
                    <div class="intro-card">
                        <div class="intro-card-icon">üèÜ</div>
                        <h3>What You'll Learn</h3>
                        <p>How to create targeted savings accounts for specific purchases and goals</p>
                    </div>
                </div>
            </div>
            <div class="screen-navigation">
                <div class="nav-spacer"></div>
                <button class="btn-nav" onclick="nextScreen()">Next ‚Üí</button>
            </div>
        </div>

        <!-- Screen 2 -->
        <div class="lesson-screen" data-screen="2">
            <div class="screen-progress">Screen 2 of 8</div>
            <div class="lesson-section">
                <h2>Core Concept: What Is a Sinking Fund?</h2>
                <p><strong>A sinking fund is money you set aside each month for a specific future expense. Think of it as planned spending, not emergency spending.</strong></p>
                <div class="visual-box">
                    <h3>Emergency Fund vs. Sinking Fund</h3>
                    <p><strong>Emergency Fund:</strong> Unexpected emergencies (job loss, medical bills, car breakdown). You hope to never use it.</p>
                    <p style="margin-top: 10px;"><strong>Sinking Fund:</strong> Expected expenses you know are coming (vacation, car insurance, holidays). You plan to spend it.</p>
                </div>
                <div class="visual-box">
                    <h3>How Sinking Funds Work</h3>
                    <ul>
                        <li>Identify a future expense (vacation costs $1,200)</li>
                        <li>Decide when you need it (12 months from now)</li>
                        <li>Divide: $1,200 √∑ 12 = $100/month</li>
                        <li>Save $100 each month in a separate account</li>
                        <li>When it's time, the money is ready‚Äîno stress!</li>
                    </ul>
                </div>
            </div>
            <div class="screen-navigation">
                <button class="btn-nav btn-prev" onclick="previousScreen()">‚Üê Previous</button>
                <button class="btn-nav" onclick="nextScreen()">Next ‚Üí</button>
            </div>
        </div>

        <!-- Screen 3: Checkpoint 1 -->
        <div class="lesson-screen" data-screen="3">
            <div class="screen-progress">Screen 3 of 8</div>
            <div class="checkpoint-container">
                <div class="checkpoint-header">
                    <h3>Quick Check</h3>
                </div>
                <div class="checkpoint-question">
                    <div class="question-text">What's the main difference between an emergency fund and a sinking fund?</div>
                    <div class="checkpoint-option" onclick="checkCheckpoint1(0)">
                        <input type="radio" name="checkpoint1"><span>A) Sinking funds are for unexpected emergencies</span>
                    </div>
                    <div class="checkpoint-option" onclick="checkCheckpoint1(1)">
                        <input type="radio" name="checkpoint1"><span>B) Emergency funds are for unexpected crises; sinking funds are for planned expenses</span>
                    </div>
                    <div class="checkpoint-option" onclick="checkCheckpoint1(2)">
                        <input type="radio" name="checkpoint1"><span>C) They're the same thing</span>
                    </div>
                    <div class="checkpoint-option" onclick="checkCheckpoint1(3)">
                        <input type="radio" name="checkpoint1"><span>D) Sinking funds earn higher interest</span>
                    </div>
                </div>
                <div class="checkpoint-feedback" id="checkpoint1-feedback">
                    <div class="checkpoint-feedback-title"></div>
                    <div class="checkpoint-explanation"></div>
                </div>
                <button class="btn-continue" id="checkpoint1-continue" onclick="nextScreen()">Continue ‚Üí</button>
            </div>
            <div class="screen-navigation">
                <button class="btn-nav btn-prev" onclick="previousScreen()">‚Üê Previous</button>
                <div class="nav-spacer"></div>
            </div>
        </div>

        <!-- Screen 4 -->
        <div class="lesson-screen" data-screen="4">
            <div class="screen-progress">Screen 4 of 8</div>
            <div class="lesson-section">
                <h2>Common Sinking Fund Categories</h2>
                <div class="fund-examples">
                    <div class="fund-card">
                        <div class="fund-card-icon">üöó</div>
                        <div class="fund-card-title">Car Expenses</div>
                        <div class="fund-card-desc">Insurance, registration, maintenance, new tires</div>
                    </div>
                    <div class="fund-card">
                        <div class="fund-card-icon">‚úàÔ∏è</div>
                        <div class="fund-card-title">Vacation</div>
                        <div class="fund-card-desc">Flights, hotels, activities, dining out</div>
                    </div>
                    <div class="fund-card">
                        <div class="fund-card-icon">üéÑ</div>
                        <div class="fund-card-title">Holidays</div>
                        <div class="fund-card-desc">Gifts, decorations, holiday meals</div>
                    </div>
                    <div class="fund-card">
                        <div class="fund-card-icon">üè†</div>
                        <div class="fund-card-title">Home Repairs</div>
                        <div class="fund-card-desc">New appliances, paint, yard work</div>
                    </div>
                    <div class="fund-card">
                        <div class="fund-card-icon">üíª</div>
                        <div class="fund-card-title">Technology</div>
                        <div class="fund-card-desc">New phone, laptop, upgrades</div>
                    </div>
                    <div class="fund-card">
                        <div class="fund-card-icon">üëó</div>
                        <div class="fund-card-title">Clothing</div>
                        <div class="fund-card-desc">Seasonal wardrobe, shoes, accessories</div>
                    </div>
                </div>
                <p style="margin-top: 20px;"><strong>Pro Tip:</strong> Start with 2-3 funds. Add more as you get comfortable.</p>
            </div>
            <div class="screen-navigation">
                <button class="btn-nav btn-prev" onclick="previousScreen()">‚Üê Previous</button>
                <button class="btn-nav" onclick="nextScreen()">Next ‚Üí</button>
            </div>
        </div>

        <!-- Screen 5: Checkpoint 2 -->
        <div class="lesson-screen" data-screen="5">
            <div class="screen-progress">Screen 5 of 8</div>
            <div class="checkpoint-container">
                <div class="checkpoint-header">
                    <h3>Apply What You Learned</h3>
                </div>
                <div class="checkpoint-question">
                    <div class="question-text">If you want to save $600 for holiday gifts in 10 months, how much should you save per month?</div>
                    <div class="checkpoint-option" onclick="checkCheckpoint2(0)">
                        <input type="radio" name="checkpoint2"><span>A) $30</span>
                    </div>
                    <div class="checkpoint-option" onclick="checkCheckpoint2(1)">
                        <input type="radio" name="checkpoint2"><span>B) $60</span>
                    </div>
                    <div class="checkpoint-option" onclick="checkCheckpoint2(2)">
                        <input type="radio" name="checkpoint2"><span>C) $100</span>
                    </div>
                    <div class="checkpoint-option" onclick="checkCheckpoint2(3)">
                        <input type="radio" name="checkpoint2"><span>D) $150</span>
                    </div>
                </div>
                <div class="checkpoint-feedback" id="checkpoint2-feedback">
                    <div class="checkpoint-feedback-title"></div>
                    <div class="checkpoint-explanation"></div>
                </div>
                <button class="btn-continue" id="checkpoint2-continue" onclick="nextScreen()">Continue ‚Üí</button>
            </div>
            <div class="screen-navigation">
                <button class="btn-nav btn-prev" onclick="previousScreen()">‚Üê Previous</button>
                <div class="nav-spacer"></div>
            </div>
        </div>

        <!-- Screen 6: Common Mistakes -->
        <div class="lesson-screen" data-screen="6">
            <div class="screen-progress">Screen 6 of 8</div>
            <div class="lesson-section">
                <h2>Avoid These Sinking Fund Mistakes</h2>
                <div class="mistakes-grid">
                    <div class="mistake-card">
                        <div class="mistake-icon">ü§π</div>
                        <div class="mistake-title">Too Many Funds</div>
                        <div class="mistake-desc">Start with 2-3 priorities. Don't create 15 funds‚Äîit's overwhelming</div>
                    </div>
                    <div class="mistake-card">
                        <div class="mistake-icon">üè¶</div>
                        <div class="mistake-title">Using Emergency Fund</div>
                        <div class="mistake-desc">Vacations aren't emergencies! Keep funds separate</div>
                    </div>
                    <div class="mistake-card">
                        <div class="mistake-icon">üìä</div>
                        <div class="mistake-title">Not Tracking Progress</div>
                        <div class="mistake-desc">Use a spreadsheet or app to monitor each fund's growth</div>
                    </div>
                    <div class="mistake-card">
                        <div class="mistake-icon">üí∏</div>
                        <div class="mistake-title">Raiding the Fund Early</div>
                        <div class="mistake-desc">Stick to the plan! Don't dip in for impulse purchases</div>
                    </div>
                </div>
            </div>
            <div class="screen-navigation">
                <button class="btn-nav btn-prev" onclick="previousScreen()">‚Üê Previous</button>
                <button class="btn-nav" onclick="nextScreen()">Next ‚Üí</button>
            </div>
        </div>

        <!-- Screen 7: Action Plan -->
        <div class="lesson-screen" data-screen="7">
            <div class="screen-progress">Screen 7 of 8</div>
            <div class="lesson-section">
                <div class="action-checklist">
                    <div class="checklist-title">üéØ Your Sinking Fund Action Plan</div>
                    <div class="checklist-item" onclick="toggleChecklistItem(this)">
                        <div class="checklist-checkbox"></div>
                        <div>List 2-3 upcoming expenses in the next 6-12 months</div>
                    </div>
                    <div class="checklist-item" onclick="toggleChecklistItem(this)">
                        <div class="checklist-checkbox"></div>
                        <div>Calculate how much to save monthly for each goal</div>
                    </div>
                    <div class="checklist-item" onclick="toggleChecklistItem(this)">
                        <div class="checklist-checkbox"></div>
                        <div>Open separate savings accounts or create budget categories for each fund</div>
                    </div>
                    <div class="checklist-item" onclick="toggleChecklistItem(this)">
                        <div class="checklist-checkbox"></div>
                        <div>Set up automatic monthly transfers to each sinking fund</div>
                    </div>
                </div>
                <div class="reflection-box">
                    <div class="reflection-title">Quick Reflection</div>
                    <p>What's one expense you could start a sinking fund for today? Even $25/month adds up to $300 in a year!</p>
                </div>
            </div>
            <div class="screen-navigation">
                <button class="btn-nav btn-prev" onclick="previousScreen()">‚Üê Previous</button>
                <button class="btn-nav" onclick="nextScreen()">Next ‚Üí</button>
            </div>
        </div>

        <!-- Screen 8: Quiz -->
        <div class="lesson-screen" data-screen="8">
            <div class="screen-progress">Screen 8 of 8</div>
            <div class="quiz-container" id="quizContainer">
                <div class="quiz-header">
                    <h2>Lesson Quiz</h2>
                    <p>Answer all questions correctly to unlock the next lesson!</p>
                </div>
                <div id="quizQuestions"></div>
                <button class="btn-submit-quiz" id="submitQuiz" onclick="submitQuiz()">Submit Quiz</button>
                <div id="quizResult"></div>
            </div>
            <button class="btn-finish" id="finishBtn" onclick="finishLesson()" disabled>Finish Lesson</button>
            <div class="screen-navigation">
                <button class="btn-nav btn-prev" onclick="previousScreen()">‚Üê Previous</button>
                <div class="nav-spacer"></div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>FinanceU</h4>
                    <p>Making financial literacy accessible for everyone.</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 FinanceU. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="config.js"></script>
    <script src="lesson-completion.js"></script>
    <script src="animations.js"></script>
    <script>
        async function updateNav() {
            const authButtons = document.getElementById('authButtons');
            const cachedAuth = localStorage.getItem('authState');
            if (cachedAuth) {
                const authState = JSON.parse(cachedAuth);
                authButtons.innerHTML = authState.isLoggedIn ? `<a href="#" onclick="logout(); return false;" class="btn-primary">Logout</a>` : `<a href="login" class="btn-primary">Login</a>`;
                authButtons.style.opacity = '1';
            }
            try {
                const response = await fetch(`${API_URL}/auth/me`, { credentials: 'include' });
                if (response.ok) {
                    localStorage.setItem('authState', JSON.stringify({ isLoggedIn: true }));
                    authButtons.innerHTML = `<a href="#" onclick="logout(); return false;" class="btn-primary">Logout</a>`;
                } else {
                    localStorage.setItem('authState', JSON.stringify({ isLoggedIn: false }));
                    authButtons.innerHTML = `<a href="login" class="btn-primary">Login</a>`;
                }
                authButtons.style.opacity = '1';
            } catch (error) {
                localStorage.setItem('authState', JSON.stringify({ isLoggedIn: false }));
                authButtons.innerHTML = `<a href="login" class="btn-primary">Login</a>`;
                authButtons.style.opacity = '1';
            }
        }
        async function logout() {
            localStorage.removeItem('authState');
            localStorage.removeItem('token');
            localStorage.removeItem('userId');
            try {
                await fetch(`${API_URL}/auth/logout`, { method: 'POST', credentials: 'include' });
                window.location.href = '/index.html';
            } catch (error) {
                window.location.href = '/index.html';
            }
        }

        const quizData = [
            { question: "What is a sinking fund?", options: ["Emergency savings only", "Money set aside for a specific planned expense", "Retirement account", "Investment fund"], correct: 1 },
            { question: "If you need $900 in 6 months, how much should you save monthly?", options: ["$90", "$150", "$180", "$450"], correct: 1 },
            { question: "Which expense is best suited for a sinking fund?", options: ["Unexpected medical emergency", "Annual car insurance payment", "Job loss", "Broken water heater"], correct: 1 }
        ];

        let userAnswers = [];
        let quizPassed = false;

        function initQuiz() {
            const userId = localStorage.getItem('userId');
            if (!userId || userId === 'null' || userId === 'undefined') {
                document.getElementById('finishBtn').disabled = true;
                return;
            }
            const quizPassedStatus = localStorage.getItem(`pillar4_lesson6_quiz_passed_${userId}`);
            if (quizPassedStatus === 'true') {
                quizPassed = true;
                document.getElementById('finishBtn').disabled = false;
                document.getElementById('quizContainer').style.display = 'none';
                return;
            }
            renderQuiz();
        }

        function renderQuiz() {
            const questionsContainer = document.getElementById('quizQuestions');
            questionsContainer.innerHTML = '';
            userAnswers = new Array(quizData.length).fill(null);
            quizData.forEach((q, qIndex) => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                questionCard.innerHTML = `
                    <div class="question-text">Question ${qIndex + 1}: ${q.question}</div>
                    ${q.options.map((option, oIndex) => `
                        <div class="answer-option" onclick="selectAnswer(${qIndex}, ${oIndex})">
                            <input type="radio" name="question${qIndex}" value="${oIndex}" style="margin-right: 10px;">${option}
                        </div>
                    `).join('')}
                `;
                questionsContainer.appendChild(questionCard);
            });
        }

        function selectAnswer(questionIndex, optionIndex) {
            userAnswers[questionIndex] = optionIndex;
            const questionCard = document.querySelectorAll('.question-card')[questionIndex];
            const options = questionCard.querySelectorAll('.answer-option');
            options.forEach((opt, idx) => {
                opt.classList.remove('selected');
                if (idx === optionIndex) {
                    opt.classList.add('selected');
                    opt.querySelector('input').checked = true;
                }
            });
        }

        function submitQuiz() {
            if (userAnswers.includes(null)) {
                alert('Please answer all questions before submitting.');
                return;
            }
            let correct = 0;
            quizData.forEach((q, index) => {
                if (userAnswers[index] === q.correct) correct++;
            });
            const percentage = Math.round((correct / quizData.length) * 100);
            const passed = percentage === 100;
            document.querySelectorAll('.question-card').forEach((card, qIndex) => {
                const options = card.querySelectorAll('.answer-option');
                options.forEach((opt, oIndex) => {
                    opt.style.pointerEvents = 'none';
                    if (oIndex === quizData[qIndex].correct) opt.classList.add('correct');
                    else if (oIndex === userAnswers[qIndex] && oIndex !== quizData[qIndex].correct) opt.classList.add('incorrect');
                });
            });
            const resultDiv = document.getElementById('quizResult');
            if (passed) {
                quizPassed = true;
                const userId = localStorage.getItem('userId');
                localStorage.setItem(`pillar4_lesson6_quiz_passed_${userId}`, 'true');
                document.getElementById('finishBtn').disabled = false;
                resultDiv.innerHTML = `<div class="quiz-result pass"><div style="font-size: 48px;">üéâ</div><div style="font-size: 24px; font-weight: 700; color: #10b981;">Quiz Passed!</div><p>Great job! You can now finish the lesson.</p></div>`;
            } else {
                resultDiv.innerHTML = `<div class="quiz-result fail"><div style="font-size: 48px;">üìö</div><div style="font-size: 24px; font-weight: 700; color: #dc2626;">Not quite there yet</div><p>You need 100% to pass. Review and try again!</p><button class="btn-retry" onclick="retryQuiz()">Retry Quiz</button></div>`;
            }
            document.getElementById('submitQuiz').style.display = 'none';
        }

        function retryQuiz() {
            renderQuiz();
            document.getElementById('quizResult').innerHTML = '';
            document.getElementById('submitQuiz').style.display = 'block';
        }

        async function finishLesson() {
            if (!quizPassed) {
                alert('Please complete the quiz first!');
                return;
            }
            const success = await completeLesson('pillar4_lesson6', 4, 6);
            if (success) window.location.href = 'pillar4-lessons.html';
        }

        let currentScreen = 1;
        function showScreen(screenNumber) {
            document.querySelectorAll('.lesson-screen').forEach(screen => screen.classList.remove('active'));
            const targetScreen = document.querySelector(`.lesson-screen[data-screen="${screenNumber}"]`);
            if (targetScreen) {
                targetScreen.classList.add('active');
                currentScreen = screenNumber;
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }
        function nextScreen() { if (currentScreen < 8) showScreen(currentScreen + 1); }
        function previousScreen() { if (currentScreen > 1) showScreen(currentScreen - 1); }

        let checkpoint1Answered = false;
        function checkCheckpoint1(selected) {
            if (checkpoint1Answered) return;
            checkpoint1Answered = true;
            const correct = 1;
            document.querySelectorAll('[name="checkpoint1"]').forEach((radio, index) => {
                const optionDiv = radio.parentElement;
                optionDiv.style.pointerEvents = 'none';
                if (index === correct) optionDiv.classList.add('correct');
                else if (index === selected) optionDiv.classList.add('incorrect');
                if (index === selected) radio.checked = true;
            });
            const feedback = document.getElementById('checkpoint1-feedback');
            feedback.querySelector('.checkpoint-feedback-title').textContent = selected === correct ? 'Correct!' : 'Not quite!';
            feedback.querySelector('.checkpoint-explanation').textContent = 'Emergency funds cover unexpected crises. Sinking funds help you save for planned expenses like vacations or car insurance.';
            feedback.classList.add('show', selected === correct ? 'correct' : 'incorrect');
            document.getElementById('checkpoint1-continue').classList.add('show');
        }

        let checkpoint2Answered = false;
        function checkCheckpoint2(selected) {
            if (checkpoint2Answered) return;
            checkpoint2Answered = true;
            const correct = 1;
            document.querySelectorAll('[name="checkpoint2"]').forEach((radio, index) => {
                const optionDiv = radio.parentElement;
                optionDiv.style.pointerEvents = 'none';
                if (index === correct) optionDiv.classList.add('correct');
                else if (index === selected) optionDiv.classList.add('incorrect');
                if (index === selected) radio.checked = true;
            });
            const feedback = document.getElementById('checkpoint2-feedback');
            feedback.querySelector('.checkpoint-feedback-title').textContent = selected === correct ? 'Excellent!' : 'Not quite!';
            feedback.querySelector('.checkpoint-explanation').textContent = '$600 √∑ 10 months = $60 per month. This is the basic sinking fund calculation!';
            feedback.classList.add('show', selected === correct ? 'correct' : 'incorrect');
            document.getElementById('checkpoint2-continue').classList.add('show');
        }

        function toggleChecklistItem(item) {
            item.classList.toggle('checked');
            const checkbox = item.querySelector('.checklist-checkbox');
            checkbox.textContent = item.classList.contains('checked') ? '‚úì' : '';
        }

        updateNav();
        initQuiz();
        showScreen(1);
    </script>
</body>
</html>
