<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 4 - High-Yield Savings Accounts - FinanceU</title>
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <link rel="icon" type="image/svg+xml" sizes="16x16" href="assets/favicon-16x16.svg">
    <link rel="icon" type="image/svg+xml" sizes="32x32" href="assets/favicon-32x32.svg">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/apple-touch-icon.svg">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background: #FFFFFF;
            overflow-x: hidden;
        }

        .back-link {
            position: fixed;
            top: 100px;
            left: 40px;
            z-index: 100;
            padding: 10px 20px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            color: #2563eb;
            text-decoration: none;
            font-weight: 600;
        }

        .back-link:hover {
            transform: translateX(-3px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }

        /* Progress Bar */
        .progress-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 8px;
            background: #f1f5f9;
            z-index: 100;
        }

        .progress-bar {
            height: 100%;
            background: #2563eb;
            transition: width 0.3s ease;
            border-radius: 0 4px 4px 0;
        }

        /* Chapter Sections */
        .chapter {
            min-height: 100vh;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 120px 40px 80px;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }

        .chapter.active {
            display: flex;
            animation: fadeInUp 0.6s ease forwards;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chapter-content {
            max-width: 1000px;
            width: 100%;
        }

        /* Hero Chapter */
        .hero-chapter {
            background: #FFFFFF;
            text-align: center;
        }

        .lesson-number {
            color: #2563eb;
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 20px;
        }

        .hero-title {
            font-size: clamp(40px, 6vw, 72px);
            font-weight: 800;
            color: #000000;
            margin-bottom: 24px;
            line-height: 1.1;
        }

        .hero-subtitle {
            font-size: 20px;
            color: #4a4a4a;
            margin-bottom: 40px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Content Chapter */
        .content-chapter {
            background: #f8f9fa;
        }

        .section-number {
            display: inline-block;
            padding: 8px 20px;
            background: #2563eb;
            color: white;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 24px;
        }

        .content-title {
            font-size: clamp(32px, 4vw, 48px);
            font-weight: 800;
            color: #000000;
            margin-bottom: 24px;
            line-height: 1.2;
        }

        .content-text {
            font-size: 18px;
            line-height: 1.8;
            color: #4a4a4a;
            margin-bottom: 20px;
        }

        .content-text strong {
            color: #000000;
            font-weight: 700;
        }

        .highlight-box {
            background: white;
            border-left: 4px solid #2563eb;
            padding: 24px;
            border-radius: 8px;
            margin: 30px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .highlight-box h3 {
            color: #2563eb;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .highlight-box p {
            color: #4a4a4a;
            font-size: 16px;
            line-height: 1.6;
            margin: 0;
        }

        /* Comparison Grid */
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin: 40px 0;
        }

        .comparison-card {
            background: white;
            padding: 32px;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .comparison-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        }

        .comparison-card.losing {
            border-color: #dc2626;
        }

        .comparison-card.winning {
            border-color: #10b981;
        }

        .comparison-card h3 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .comparison-card.losing h3 {
            color: #dc2626;
        }

        .comparison-card.winning h3 {
            color: #10b981;
        }

        .rate {
            font-size: 48px;
            font-weight: 800;
            margin: 20px 0;
        }

        .comparison-card.losing .rate {
            color: #dc2626;
        }

        .comparison-card.winning .rate {
            color: #10b981;
        }

        .comparison-details {
            color: #4a4a4a;
            font-size: 16px;
            line-height: 1.6;
        }

        .comparison-details p {
            margin: 8px 0;
        }

        /* Calculator Chapter */
        .calculator-chapter {
            background: #FFFFFF;
        }

        .calculator-container {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            border: 1px solid #e5e5e5;
        }

        .calculator-inputs {
            display: grid;
            gap: 24px;
            margin-bottom: 32px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .input-group label {
            font-weight: 700;
            color: #000000;
            font-size: 16px;
        }

        .input-group input[type="number"],
        .input-group input[type="range"] {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e5e5;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            transition: border-color 0.2s;
        }

        .input-group input[type="number"]:focus {
            outline: none;
            border-color: #2563eb;
        }

        .input-group input[type="range"] {
            padding: 0;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: #e5e5e5;
            border: none;
        }

        .input-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #2563eb;
            cursor: pointer;
            border-radius: 50%;
        }

        .input-group input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #2563eb;
            cursor: pointer;
            border-radius: 50%;
            border: none;
        }

        .range-value {
            font-size: 18px;
            font-weight: 700;
            color: #2563eb;
            text-align: right;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-top: 40px;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 32px;
        }

        .result-card {
            background: #f8f9fa;
            padding: 24px;
            border-radius: 12px;
            text-align: center;
        }

        .result-label {
            font-size: 14px;
            color: #4a4a4a;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }

        .result-value {
            font-size: 36px;
            font-weight: 800;
            margin-bottom: 8px;
        }

        .result-card.traditional .result-value {
            color: #dc2626;
        }

        .result-card.high-yield .result-value {
            color: #10b981;
        }

        .result-description {
            font-size: 14px;
            color: #4a4a4a;
        }

        .difference-card {
            grid-column: 1 / -1;
            background: #2563eb;
            color: white;
            padding: 24px;
            border-radius: 12px;
            text-align: center;
        }

        .difference-card h3 {
            font-size: 20px;
            margin-bottom: 12px;
            font-weight: 700;
        }

        .difference-amount {
            font-size: 48px;
            font-weight: 800;
            margin-bottom: 8px;
        }

        .difference-description {
            font-size: 16px;
            opacity: 0.9;
        }

        /* Action Steps */
        .action-steps {
            display: grid;
            gap: 20px;
            margin-top: 40px;
        }

        .action-step {
            background: white;
            padding: 24px;
            border-radius: 12px;
            border-left: 4px solid #2563eb;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            display: flex;
            gap: 20px;
            align-items: start;
        }

        .step-number {
            background: #2563eb;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 18px;
            flex-shrink: 0;
        }

        .step-content h4 {
            color: #000000;
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .step-content p {
            color: #4a4a4a;
            font-size: 16px;
            line-height: 1.6;
            margin: 0;
        }

        /* Navigation */
        .chapter-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 60px;
            padding-top: 30px;
            border-top: 2px solid #e5e5e5;
        }

        .nav-btn {
            padding: 14px 32px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-btn:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .nav-btn:disabled {
            background: #d1d5db;
            cursor: not-allowed;
            transform: none;
        }

        .nav-btn.prev {
            background: #6b7280;
        }

        .nav-btn.prev:hover {
            background: #4b5563;
        }

        /* Quiz Styles */
        .quiz-container {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            border: 2px solid #2563eb;
        }

        .quiz-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .quiz-header h2 {
            color: #2563eb;
            font-size: 32px;
            margin-bottom: 12px;
        }

        .quiz-header p {
            color: #4a4a4a;
            font-size: 18px;
        }

        .question-card {
            background: #f8f9fa;
            padding: 32px;
            border-radius: 12px;
            margin-bottom: 24px;
        }

        .question-text {
            font-size: 20px;
            font-weight: 700;
            color: #000000;
            margin-bottom: 20px;
        }

        .answer-option {
            background: white;
            padding: 16px 20px;
            border: 2px solid #e5e5e5;
            border-radius: 8px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 16px;
            color: #000000;
        }

        .answer-option:hover {
            border-color: #2563eb;
            background: #eff6ff;
        }

        .answer-option.selected {
            border-color: #2563eb;
            background: #dbeafe;
        }

        .answer-option.correct {
            border-color: #10b981;
            background: #d1fae5;
        }

        .answer-option.incorrect {
            border-color: #dc2626;
            background: #fee2e2;
        }

        .btn-submit-quiz {
            display: block;
            width: 100%;
            max-width: 300px;
            margin: 32px auto;
            padding: 16px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-submit-quiz:hover {
            background: #1d4ed8;
        }

        .btn-submit-quiz:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .quiz-result {
            background: white;
            padding: 32px;
            border-radius: 12px;
            text-align: center;
            margin-top: 24px;
        }

        .quiz-result.pass {
            border: 3px solid #10b981;
        }

        .quiz-result.fail {
            border: 3px solid #dc2626;
        }

        .result-text {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 12px;
        }

        .result-score {
            font-size: 20px;
            color: #4a4a4a;
            margin-bottom: 24px;
        }

        .btn-retry {
            padding: 12px 24px;
            background: #f59e0b;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
        }

        .btn-retry:hover {
            background: #d97706;
        }

        .btn-finish {
            display: block;
            width: 100%;
            max-width: 400px;
            margin: 40px auto 0;
            padding: 18px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-finish:hover {
            background: #1d4ed8;
        }

        .btn-finish:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            opacity: 0.6;
        }
    </style>
</head>
<body class="homepage-dark">
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-wrapper">
                <div class="logo"><a href="/" style="color: inherit; text-decoration: none;">Finance<span class="logo-accent">U</span></a></div>
                <ul class="nav-links">
                    <li><a href="/">Home</a></li>
                    <li><a href="dashboard">Dashboard</a></li>
                    <li id="authButtons" style="opacity: 0;"></li>
                </ul>
            </div>
        </div>
    </nav>

    <a href="/path1-lessons" class="back-link">← Back</a>

    <!-- Progress Bar -->
    <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
    </div>

    <!-- Chapter 1: Hero -->
    <div class="chapter hero-chapter active" data-chapter="1">
        <div class="chapter-content">
            <div class="lesson-number">LESSON 4</div>
            <h1 class="hero-title">High-Yield Savings Accounts</h1>
            <p class="hero-subtitle">Stop leaving money on the table. Learn how to make your savings work 40x harder with the same safety.</p>
            <div class="chapter-nav">
                <div></div>
                <button class="nav-btn" onclick="nextChapter()">Start Learning →</button>
            </div>
        </div>
    </div>

    <!-- Chapter 2: The Problem -->
    <div class="chapter content-chapter" data-chapter="2">
        <div class="chapter-content">
            <span class="section-number">The Problem</span>
            <h2 class="content-title">Your Bank Is Paying You Almost Nothing</h2>
            <p class="content-text">Most traditional banks pay <strong>0.01% to 0.10% APY</strong> on savings accounts. That means if you have $5,000 saved, you earn about <strong>$5 per year</strong>.</p>
            <p class="content-text">Why? Because they can get away with it. They take your money, lend it out at 7-20% interest, and pocket the difference.</p>

            <div class="highlight-box">
                <h3>The Reality Check</h3>
                <p>With inflation around 3% per year, your money sitting in a traditional savings account is actually <strong>losing value</strong>. You're going backwards.</p>
            </div>

            <div class="comparison-grid">
                <div class="comparison-card losing">
                    <h3>Traditional Savings</h3>
                    <div class="rate">0.01%</div>
                    <div class="comparison-details">
                        <p><strong>$5,000 saved</strong></p>
                        <p>After 1 year: $5,000.50</p>
                        <p><strong>Earned: $0.50</strong></p>
                        <p style="margin-top: 12px; font-style: italic;">Basically nothing. Not even worth checking.</p>
                    </div>
                </div>
                <div class="comparison-card winning">
                    <h3>High-Yield Savings</h3>
                    <div class="rate">4.50%</div>
                    <div class="comparison-details">
                        <p><strong>$5,000 saved</strong></p>
                        <p>After 1 year: $5,225</p>
                        <p><strong>Earned: $225</strong></p>
                        <p style="margin-top: 12px; font-style: italic;">Real money for doing literally nothing.</p>
                    </div>
                </div>
            </div>

            <div class="chapter-nav">
                <button class="nav-btn prev" onclick="prevChapter()">← Back</button>
                <button class="nav-btn" onclick="nextChapter()">Continue →</button>
            </div>
        </div>
    </div>

    <!-- Chapter 3: Interactive Calculator -->
    <div class="chapter calculator-chapter" data-chapter="3">
        <div class="chapter-content">
            <span class="section-number">Interactive Calculator</span>
            <h2 class="content-title">See Your Own Numbers</h2>
            <p class="content-text">Adjust the values below to see how much you could be earning with a high-yield savings account.</p>

            <div class="calculator-container">
                <div class="calculator-inputs">
                    <div class="input-group">
                        <label for="savingsAmount">How much do you have saved?</label>
                        <input type="range" id="savingsAmountSlider" min="100" max="50000" value="5000" step="100" oninput="updateCalculator()">
                        <div class="range-value">$<span id="savingsAmountValue">5,000</span></div>
                    </div>
                    <div class="input-group">
                        <label for="timeYears">For how many years?</label>
                        <input type="range" id="timeYearsSlider" min="1" max="10" value="5" step="1" oninput="updateCalculator()">
                        <div class="range-value"><span id="timeYearsValue">5</span> years</div>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="growthChart"></canvas>
                </div>

                <div class="results-grid">
                    <div class="result-card traditional">
                        <div class="result-label">Traditional (0.01%)</div>
                        <div class="result-value" id="traditionalResult">$5,002.50</div>
                        <div class="result-description">Total after <span id="yearsTraditional">5</span> years</div>
                    </div>
                    <div class="result-card high-yield">
                        <div class="result-label">High-Yield (4.50%)</div>
                        <div class="result-value" id="highYieldResult">$6,230.47</div>
                        <div class="result-description">Total after <span id="yearsHighYield">5</span> years</div>
                    </div>
                    <div class="difference-card">
                        <h3>You're Missing Out On</h3>
                        <div class="difference-amount" id="differenceAmount">$1,227.97</div>
                        <div class="difference-description">That's free money just for moving your savings to a different account.</div>
                    </div>
                </div>
            </div>

            <div class="chapter-nav">
                <button class="nav-btn prev" onclick="prevChapter()">← Back</button>
                <button class="nav-btn" onclick="nextChapter()">Continue →</button>
            </div>
        </div>
    </div>

    <!-- Chapter 4: How It Works -->
    <div class="chapter content-chapter" data-chapter="4">
        <div class="chapter-content">
            <span class="section-number">How It Works</span>
            <h2 class="content-title">Why High-Yield Accounts Pay More</h2>
            <p class="content-text">High-yield savings accounts are offered by <strong>online banks</strong> like Marcus (Goldman Sachs), Ally Bank, American Express, and Discover.</p>
            <p class="content-text"><strong>No physical branches = way lower costs.</strong> They pass those savings on to you through higher interest rates.</p>

            <div class="highlight-box">
                <h3>Same Safety, Better Returns</h3>
                <p>High-yield accounts have the <strong>exact same FDIC insurance</strong> as traditional banks (up to $250,000 per account). Your money is just as safe.</p>
            </div>

            <p class="content-text"><strong>Common Questions:</strong></p>
            <p class="content-text"><strong>Q: What's the catch?</strong><br>A: No catch. Online-only = lower costs = higher rates for you.</p>
            <p class="content-text"><strong>Q: Can I access my money quickly?</strong><br>A: Yes. Transfer back to checking takes 1-3 days. It's a savings account - you shouldn't need instant access.</p>
            <p class="content-text"><strong>Q: Will rates drop?</strong><br>A: Rates fluctuate with the economy, but high-yield will always pay way more than traditional banks.</p>

            <div class="chapter-nav">
                <button class="nav-btn prev" onclick="prevChapter()">← Back</button>
                <button class="nav-btn" onclick="nextChapter()">Continue →</button>
            </div>
        </div>
    </div>

    <!-- Chapter 5: Action Steps -->
    <div class="chapter calculator-chapter" data-chapter="5">
        <div class="chapter-content">
            <span class="section-number">Take Action</span>
            <h2 class="content-title">How to Open a High-Yield Account</h2>
            <p class="content-text">It takes 10 minutes. Here's exactly what to do:</p>

            <div class="action-steps">
                <div class="action-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h4>Compare Banks</h4>
                        <p>Go to NerdWallet or Bankrate. Look for accounts with 4%+ APY, $0 minimum balance, and no monthly fees.</p>
                    </div>
                </div>
                <div class="action-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h4>Open Account Online</h4>
                        <p>Click "Open Account" on their website. You'll need your ID, social security number, and address. Takes 10 minutes.</p>
                    </div>
                </div>
                <div class="action-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h4>Link Your Current Bank</h4>
                        <p>Enter your current bank's routing and account numbers. This lets you transfer money between accounts.</p>
                    </div>
                </div>
                <div class="action-step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <h4>Transfer Your Savings</h4>
                        <p>Move your savings money to the high-yield account. Keep your checking account for daily expenses.</p>
                    </div>
                </div>
                <div class="action-step">
                    <div class="step-number">5</div>
                    <div class="step-content">
                        <h4>Watch It Grow</h4>
                        <p>Check back monthly. You'll see real interest adding up - it's addicting in the best way.</p>
                    </div>
                </div>
            </div>

            <div class="highlight-box" style="margin-top: 40px;">
                <h3>The Bottom Line</h3>
                <p>If someone offered you $200+ every year for 10 minutes of work, you'd do it. That's what this is. <strong>The biggest mistake is doing nothing.</strong></p>
            </div>

            <div class="chapter-nav">
                <button class="nav-btn prev" onclick="prevChapter()">← Back</button>
                <button class="nav-btn" onclick="nextChapter()">Take Quiz →</button>
            </div>
        </div>
    </div>

    <!-- Chapter 6: Quiz -->
    <div class="chapter content-chapter" data-chapter="6">
        <div class="chapter-content">
            <div class="quiz-container" id="quizContainer">
                <div class="quiz-header">
                    <h2>Knowledge Check</h2>
                    <p>Answer these 4 questions to complete the lesson. Need all correct to pass.</p>
                </div>
                <div id="quizQuestions"></div>
                <button class="btn-submit-quiz" id="submitQuiz" onclick="submitQuiz()">Submit Answers</button>
                <div id="quizResult"></div>
            </div>

            <button class="btn-finish" id="finishBtn" onclick="finishLesson()" disabled>Complete Lesson</button>

            <div class="chapter-nav">
                <button class="nav-btn prev" onclick="prevChapter()">← Back</button>
                <div></div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>FinanceU</h4>
                    <p>Making financial literacy accessible for everyone.</p>
                </div>
                <div class="footer-section">
                    <h4>Company</h4>
                    <ul>
                        <li><a href="/about">About Us</a></li>
                        <li><a href="/careers">Careers</a></li>
                        <li><a href="/contact">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Support</h4>
                    <ul>
                        <li><a href="/help">Help Center</a></li>
                        <li><a href="/privacy">Privacy Policy</a></li>
                        <li><a href="/terms">Terms of Service</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p style="font-size: 0.85rem; opacity: 0.8; margin-bottom: 10px;">Disclaimer: FinanceU provides educational content only and does not offer financial, legal, or investment advice. Always consult with a qualified professional before making financial decisions.</p>
                <p>&copy; 2025 FinanceU. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="config.js"></script>
    <script src="lesson-completion.js"></script>
    <script src="animations.js"></script>
    <script>
        let currentChapter = 1;
        const totalChapters = 6;
        let growthChart = null;

        async function updateNav() {
            const authButtons = document.getElementById('authButtons');
            const cachedAuth = localStorage.getItem('authState');
            if (cachedAuth) {
                const authState = JSON.parse(cachedAuth);
                authButtons.innerHTML = authState.isLoggedIn
                    ? `<a href="#" onclick="logout(); return false;" class="btn-primary">Logout</a>`
                    : `<a href="login" class="btn-primary">Login</a>`;
                authButtons.style.opacity = '1';
            }
            try {
                const response = await fetch(`${API_URL}/auth/me`, { credentials: 'include' });
                if (response.ok) {
                    localStorage.setItem('authState', JSON.stringify({ isLoggedIn: true }));
                    authButtons.innerHTML = `<a href="#" onclick="logout(); return false;" class="btn-primary">Logout</a>`;
                } else {
                    localStorage.setItem('authState', JSON.stringify({ isLoggedIn: false }));
                    authButtons.innerHTML = `<a href="login" class="btn-primary">Login</a>`;
                }
                authButtons.style.opacity = '1';
            } catch (error) {
                localStorage.setItem('authState', JSON.stringify({ isLoggedIn: false }));
                authButtons.innerHTML = `<a href="login" class="btn-primary">Login</a>`;
                authButtons.style.opacity = '1';
            }
        }

        async function logout() {
            localStorage.removeItem('authState');
            localStorage.removeItem('token');
            localStorage.removeItem('userId');
            try {
                await fetch(`${API_URL}/auth/logout`, { method: 'POST', credentials: 'include' });
                window.location.href = '/index.html';
            } catch (error) {
                window.location.href = '/index.html';
            }
        }

        function showChapter(chapterNum) {
            document.querySelectorAll('.chapter').forEach(ch => ch.classList.remove('active'));
            const targetChapter = document.querySelector(`.chapter[data-chapter="${chapterNum}"]`);
            if (targetChapter) {
                targetChapter.classList.add('active');
                currentChapter = chapterNum;
                updateProgressBar();
                window.scrollTo({ top: 0, behavior: 'smooth' });

                if (chapterNum === 3 && !growthChart) {
                    setTimeout(initChart, 100);
                }
            }
        }

        function nextChapter() {
            if (currentChapter < totalChapters) {
                showChapter(currentChapter + 1);
            }
        }

        function prevChapter() {
            if (currentChapter > 1) {
                showChapter(currentChapter - 1);
            }
        }

        function updateProgressBar() {
            const progress = (currentChapter / totalChapters) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        function initChart() {
            const ctx = document.getElementById('growthChart').getContext('2d');
            growthChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Traditional Savings (0.01%)',
                        data: [],
                        borderColor: '#dc2626',
                        backgroundColor: 'rgba(220, 38, 38, 0.1)',
                        borderWidth: 3,
                        tension: 0.4
                    }, {
                        label: 'High-Yield Savings (4.50%)',
                        data: [],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 3,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: { size: 14, weight: 'bold' },
                                padding: 15
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': $' + context.parsed.y.toFixed(2);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
            updateCalculator();
        }

        function updateCalculator() {
            const principal = parseFloat(document.getElementById('savingsAmountSlider').value);
            const years = parseInt(document.getElementById('timeYearsSlider').value);
            const traditionalRate = 0.0001;
            const highYieldRate = 0.045;

            document.getElementById('savingsAmountValue').textContent = principal.toLocaleString();
            document.getElementById('timeYearsValue').textContent = years;

            const labels = [];
            const traditionalData = [];
            const highYieldData = [];

            for (let year = 0; year <= years; year++) {
                labels.push('Year ' + year);
                traditionalData.push(principal * Math.pow(1 + traditionalRate, year));
                highYieldData.push(principal * Math.pow(1 + highYieldRate, year));
            }

            const traditionalFinal = principal * Math.pow(1 + traditionalRate, years);
            const highYieldFinal = principal * Math.pow(1 + highYieldRate, years);
            const difference = highYieldFinal - traditionalFinal;

            document.getElementById('traditionalResult').textContent = '$' + traditionalFinal.toFixed(2);
            document.getElementById('highYieldResult').textContent = '$' + highYieldFinal.toFixed(2);
            document.getElementById('differenceAmount').textContent = '$' + difference.toFixed(2);
            document.getElementById('yearsTraditional').textContent = years;
            document.getElementById('yearsHighYield').textContent = years;

            if (growthChart) {
                growthChart.data.labels = labels;
                growthChart.data.datasets[0].data = traditionalData;
                growthChart.data.datasets[1].data = highYieldData;
                growthChart.update();
            }
        }

        const quizData = [
            {
                question: "What's the typical interest rate for high-yield savings accounts as of 2025?",
                options: ["0.01% APY", "1.00% APY", "4.00-5.00% APY", "10.00% APY"],
                correct: 2
            },
            {
                question: "Why can online banks offer higher interest rates?",
                options: [
                    "They take bigger risks with your money",
                    "No physical branches = lower costs",
                    "They charge hidden fees",
                    "It's a temporary promotion"
                ],
                correct: 1
            },
            {
                question: "Are high-yield savings accounts FDIC insured like regular banks?",
                options: [
                    "No, they're riskier",
                    "Only up to $50,000",
                    "Yes, up to $250,000 per account",
                    "No insurance needed"
                ],
                correct: 2
            },
            {
                question: "How much could you earn on $5,000 over 1 year at 4.50% APY?",
                options: ["$5", "$50", "$225", "$500"],
                correct: 2
            },
            {
                question: "What is the main advantage of compound interest in a high-yield savings account?",
                options: [
                    "You earn interest on your interest over time",
                    "You pay less in taxes",
                    "You can withdraw money anytime without penalty",
                    "You get a bonus for opening the account"
                ],
                correct: 0
            }
        ];

        let userAnswers = [];
        let quizPassed = false;

        function initQuiz() {
            const userId = localStorage.getItem('userId');
            if (!userId || userId === 'null' || userId === 'undefined') {
                document.getElementById('finishBtn').disabled = true;
                return;
            }
            const quizPassedStatus = localStorage.getItem(`lesson4_quiz_passed_${userId}`);
            if (quizPassedStatus === 'true') {
                quizPassed = true;
                document.getElementById('finishBtn').disabled = false;
                document.getElementById('quizContainer').style.display = 'none';
                return;
            }
            renderQuiz();
        }

        function renderQuiz() {
            const questionsContainer = document.getElementById('quizQuestions');
            questionsContainer.innerHTML = '';
            userAnswers = new Array(quizData.length).fill(null);

            quizData.forEach((q, qIndex) => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                questionCard.innerHTML = `
                    <div class="question-text">${qIndex + 1}. ${q.question}</div>
                    ${q.options.map((option, oIndex) => `
                        <div class="answer-option" onclick="selectAnswer(${qIndex}, ${oIndex})">
                            <input type="radio" name="question${qIndex}" value="${oIndex}" style="margin-right: 10px;">
                            ${option}
                        </div>
                    `).join('')}
                `;
                questionsContainer.appendChild(questionCard);
            });

            document.getElementById('submitQuiz').disabled = false;
            document.getElementById('quizResult').innerHTML = '';
        }

        function selectAnswer(questionIndex, optionIndex) {
            userAnswers[questionIndex] = optionIndex;
            const questionCard = document.querySelectorAll('.question-card')[questionIndex];
            const options = questionCard.querySelectorAll('.answer-option');
            options.forEach((opt, idx) => {
                opt.classList.remove('selected');
                if (idx === optionIndex) {
                    opt.classList.add('selected');
                    opt.querySelector('input').checked = true;
                }
            });
        }

        function submitQuiz() {
            if (userAnswers.includes(null)) {
                alert('Please answer all questions before submitting.');
                return;
            }
            let correct = 0;
            quizData.forEach((q, index) => {
                if (userAnswers[index] === q.correct) correct++;
            });
            const percentage = Math.round((correct / quizData.length) * 100);
            const passed = percentage === 100;

            document.querySelectorAll('.question-card').forEach((card, qIndex) => {
                const options = card.querySelectorAll('.answer-option');
                options.forEach((opt, oIndex) => {
                    opt.style.pointerEvents = 'none';
                    if (oIndex === quizData[qIndex].correct) {
                        opt.classList.add('correct');
                    } else if (oIndex === userAnswers[qIndex]) {
                        opt.classList.add('incorrect');
                    }
                });
            });

            const resultDiv = document.getElementById('quizResult');
            if (passed) {
                quizPassed = true;
                const userId = localStorage.getItem('userId');
                localStorage.setItem(`lesson4_quiz_passed_${userId}`, 'true');
                document.getElementById('finishBtn').disabled = false;
                resultDiv.innerHTML = `
                    <div class="quiz-result pass">
                        <div class="result-text" style="color: #10b981;">Perfect Score!</div>
                        <div class="result-score">${correct} out of ${quizData.length} correct</div>
                        <p style="color: #4a4a4a;">You understand high-yield savings accounts. Now go open one!</p>
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `
                    <div class="quiz-result fail">
                        <div class="result-text" style="color: #dc2626;">Not Quite</div>
                        <div class="result-score">${correct} out of ${quizData.length} correct</div>
                        <p style="color: #4a4a4a; margin-bottom: 15px;">Need all correct to pass. Review the lesson and try again!</p>
                        <button class="btn-retry" onclick="retryQuiz()">Try Again</button>
                    </div>
                `;
            }
            document.getElementById('submitQuiz').style.display = 'none';
        }

        function retryQuiz() {
            renderQuiz();
            document.getElementById('submitQuiz').style.display = 'block';
        }

        async function finishLesson() {
            if (!quizPassed) {
                alert('Please complete the quiz first!');
                return;
            }
            const success = await completeLesson('path1_lesson4', 1, 4);
            if (success) {
                window.location.href = 'path1-lessons.html';
            }
        }

        updateNav();
        initQuiz();
        updateProgressBar();
    </script>
</body>
</html>
